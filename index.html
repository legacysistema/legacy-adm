<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Portal - LG Plataforma</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        /* Reset e Estilos Gerais */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }

        :root {
            --primary: #00d9ff;
            --primary-dark: #0099cc;
            --secondary: #9d4edd;
            --secondary-dark: #7b2cbf;
            --dark: #0a0a0f;
            --dark-light: #12121a;
            --darker: #050509;
            --light: #f0f0f5;
            --gray: #8888a0;
            --success: #00cc88;
            --warning: #ffaa00;
            --danger: #ff3366;
            --glass: rgba(20, 20, 30, 0.7);
            --glass-light: rgba(30, 30, 45, 0.8);
            --border: rgba(100, 100, 150, 0.2);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            --neon-glow: 0 0 10px var(--primary), 0 0 20px var(--primary);
            --neon-glow-secondary: 0 0 10px var(--secondary), 0 0 20px var(--secondary);
        }

        body {
            background: linear-gradient(135deg, var(--darker), var(--dark));
            color: var(--light);
            min-height: 100vh;
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Estilos Glass Neon */
        .glass-card {
            background: var(--glass);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            border: 1px solid var(--border);
            padding: 24px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .glass-card:hover {
            box-shadow: var(--shadow), var(--neon-glow);
            border-color: var(--primary);
        }

        .glass-card-secondary {
            border-color: rgba(157, 78, 221, 0.3);
        }

        .glass-card-secondary:hover {
            box-shadow: var(--shadow), var(--neon-glow-secondary);
            border-color: var(--secondary);
        }

        .neon-text {
            color: var(--primary);
            text-shadow: 0 0 5px var(--primary);
        }

        .neon-text-secondary {
            color: var(--secondary);
            text-shadow: 0 0 5px var(--secondary);
        }

        /* Botões */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 24px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            text-decoration: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--darker);
            box-shadow: 0 4px 15px rgba(0, 217, 255, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 217, 255, 0.5);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary), var(--secondary-dark));
            color: white;
            box-shadow: 0 4px 15px rgba(157, 78, 221, 0.3);
        }

        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(157, 78, 221, 0.5);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #cc2255);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 51, 102, 0.3);
        }

        .btn-danger:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(255, 51, 102, 0.5);
        }

        .btn-outline {
            background: transparent;
            color: var(--primary);
            border: 1px solid var(--primary);
        }

        .btn-outline:hover {
            background: rgba(0, 217, 255, 0.1);
        }

        /* Formulários */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--light);
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            background: rgba(10, 10, 15, 0.6);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--light);
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 217, 255, 0.2);
        }

        .form-control::placeholder {
            color: var(--gray);
        }

        /* Tabelas */
        .table-responsive {
            overflow-x: auto;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .table th {
            background: rgba(0, 217, 255, 0.1);
            padding: 16px;
            text-align: left;
            font-weight: 600;
            color: var(--primary);
            border-bottom: 2px solid rgba(0, 217, 255, 0.3);
        }

        .table td {
            padding: 14px 16px;
            border-bottom: 1px solid rgba(100, 100, 150, 0.1);
        }

        .table tr:hover {
            background: rgba(0, 217, 255, 0.05);
        }

        /* Badges */
        .badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }

        .badge-success {
            background: rgba(0, 204, 136, 0.2);
            color: var(--success);
        }

        .badge-warning {
            background: rgba(255, 170, 0, 0.2);
            color: var(--warning);
        }

        .badge-danger {
            background: rgba(255, 51, 102, 0.2);
            color: var(--danger);
        }

        .badge-info {
            background: rgba(0, 217, 255, 0.2);
            color: var(--primary);
        }

        /* Layout */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            margin-bottom: 30px;
            border-bottom: 1px solid var(--border);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 24px;
            font-weight: 700;
            color: var(--light);
        }

        .logo i {
            color: var(--primary);
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        /* Dashboard */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 30px;
        }

        .card-title {
            font-size: 20px;
            margin-bottom: 16px;
            color: var(--light);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-title i {
            color: var(--primary);
        }

        /* Listas */
        .list {
            list-style: none;
        }

        .list-item {
            padding: 16px;
            border-bottom: 1px solid rgba(100, 100, 150, 0.1);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .list-item:last-child {
            border-bottom: none;
        }

        .list-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: rgba(0, 217, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
            margin-bottom: 24px;
            overflow-x: auto;
        }

        .tab {
            padding: 14px 24px;
            background: transparent;
            border: none;
            color: var(--gray);
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab:hover {
            color: var(--light);
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Links */
        .links-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .link-card {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 20px;
            background: var(--glass-light);
            border-radius: 12px;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            text-decoration: none;
            color: var(--light);
        }

        .link-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: var(--neon-glow);
        }

        /* Alertas */
        .alert {
            padding: 16px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-left: 4px solid var(--primary);
        }

        .alert-warning {
            background: rgba(255, 170, 0, 0.1);
            border-left-color: var(--warning);
        }

        .alert-success {
            background: rgba(0, 204, 136, 0.1);
            border-left-color: var(--success);
        }

        .alert-danger {
            background: rgba(255, 51, 102, 0.1);
            border-left-color: var(--danger);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(5, 5, 9, 0.9);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--dark-light);
            border-radius: 16px;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--border);
            box-shadow: var(--shadow), var(--neon-glow);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--border);
        }

        .modal-header h2 {
            color: var(--primary);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--gray);
            font-size: 24px;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .modal-close:hover {
            color: var(--light);
        }

        .modal-body {
            padding: 20px;
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .links-grid {
                grid-template-columns: 1fr;
            }
            
            .table th, .table td {
                padding: 10px 12px;
            }
        }

        /* Animações */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }

        /* Status */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .status-dot.active {
            background: var(--success);
            box-shadow: 0 0 8px var(--success);
        }

        .status-dot.inactive {
            background: var(--danger);
            box-shadow: 0 0 8px var(--danger);
        }

        /* Login */
        .login-container {
            max-width: 400px;
            margin: 80px auto;
            animation: fadeIn 0.8s ease;
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-header h1 {
            font-size: 32px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Utilitários */
        .text-center {
            text-align: center;
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        .mt-20 {
            margin-top: 20px;
        }

        .hidden {
            display: none !important;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0, 217, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Tela de Login -->
    <div id="loginScreen" class="container">
        <div class="login-container">
            <div class="login-header">
                <h1><i class="fas fa-user-shield"></i> Admin Portal</h1>
                <p>Sistema Administrativo LG Plataforma</p>
            </div>
            
            <div class="glass-card">
                <h2 class="card-title">Login Administrativo</h2>
                <form id="adminLoginForm">
                    <div class="form-group">
                        <label class="form-label" for="adminEmail">E-mail</label>
                        <input type="email" id="adminEmail" class="form-control" placeholder="Digite seu e-mail" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="adminPassword">Senha</label>
                        <input type="password" id="adminPassword" class="form-control" placeholder="Digite sua senha" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-key"></i> Acessar Sistema
                    </button>
                </form>
                <div id="loginMessage" class="alert hidden mt-20"></div>
            </div>
        </div>
    </div>

    <!-- Área Administrativa -->
    <div id="adminArea" class="container hidden">
        <div class="header">
            <div class="logo">
                <i class="fas fa-user-shield"></i>
                <span>Área Administrativa</span>
            </div>
            <div class="user-menu">
                <div class="user-info">
                    <div class="avatar" id="adminAvatar">AD</div>
                    <div>
                        <div id="adminName">Administrador</div>
                        <small id="adminEmailDisplay">admin@email.com</small>
                    </div>
                </div>
                <button class="btn btn-danger" id="adminLogout">
                    <i class="fas fa-sign-out-alt"></i> Sair
                </button>
            </div>
        </div>

        <!-- Dashboard -->
        <div class="glass-card">
            <h2 class="card-title"><i class="fas fa-tachometer-alt"></i> Dashboard Administrativo</h2>
            <div class="dashboard-grid">
                <div class="glass-card glass-card-secondary">
                    <h3><i class="fas fa-users"></i> Clientes Ativos</h3>
                    <p id="activeClientsCount" style="font-size: 36px; font-weight: 700; color: var(--primary);">0</p>
                </div>
                <div class="glass-card glass-card-secondary">
                    <h3><i class="fas fa-project-diagram"></i> Projetos Ativos</h3>
                    <p id="activeProjectsCount" style="font-size: 36px; font-weight: 700; color: var(--secondary);">0</p>
                </div>
                <div class="glass-card glass-card-secondary">
                    <h3><i class="fas fa-clock"></i> Prazos Hoje</h3>
                    <p id="todayDeadlinesCount" style="font-size: 36px; font-weight: 700; color: var(--warning);">0</p>
                </div>
                <div class="glass-card glass-card-secondary">
                    <h3><i class="fas fa-bell"></i> Alertas Ativos</h3>
                    <p id="activeAlertsCount" style="font-size: 36px; font-weight: 700; color: var(--danger);">0</p>
                </div>
            </div>
        </div>

        <!-- Abas da Administração -->
        <div class="glass-card">
            <div class="tabs" id="adminTabs">
                <button class="tab active" data-tab="clients">Gerenciar Clientes</button>
                <button class="tab" data-tab="projects">Gerenciar Projetos</button>
                <button class="tab" data-tab="alerts">Alertas e Notificações</button>
                <button class="tab" data-tab="content">Conteúdo Personalizado</button>
                <button class="tab" data-tab="settings">Configurações</button>
            </div>

            <!-- Gerenciar Clientes -->
            <div id="clients" class="tab-content active">
                <div class="text-center mb-20">
                    <button class="btn btn-primary" id="addClientBtn">
                        <i class="fas fa-user-plus"></i> Adicionar Cliente
                    </button>
                    <button class="btn btn-secondary" id="exportClientsBtn">
                        <i class="fas fa-file-export"></i> Exportar Clientes
                    </button>
                </div>
                <div class="table-responsive">
                    <table class="table" id="clientsTable">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>CPF</th>
                                <th>E-mail</th>
                                <th>Status</th>
                                <th>Projeto</th>
                                <th>Último Acesso</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="clientsTableBody"></tbody>
                    </table>
                </div>
            </div>

            <!-- Gerenciar Projetos -->
            <div id="projects" class="tab-content">
                <div class="text-center mb-20">
                    <button class="btn btn-primary" id="addProjectBtn">
                        <i class="fas fa-folder-plus"></i> Adicionar Projeto
                    </button>
                </div>
                <div class="table-responsive">
                    <table class="table" id="projectsTable">
                        <thead>
                            <tr>
                                <th>Nome do Projeto</th>
                                <th>Cliente</th>
                                <th>Progresso</th>
                                <th>Status</th>
                                <th>Prazo Final</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="projectsTableBody"></tbody>
                    </table>
                </div>
            </div>

            <!-- Alertas e Notificações -->
            <div id="alerts" class="tab-content">
                <div class="text-center mb-20">
                    <button class="btn btn-primary" id="addAlertBtn">
                        <i class="fas fa-bell-plus"></i> Criar Alerta
                    </button>
                    <button class="btn btn-secondary" id="sendBulkAlertBtn">
                        <i class="fas fa-broadcast-tower"></i> Alerta em Massa
                    </button>
                </div>
                <div id="adminAlertsContainer"></div>
            </div>

            <!-- Conteúdo Personalizado -->
            <div id="content" class="tab-content">
                <div class="glass-card mb-20">
                    <h3 class="card-title"><i class="fas fa-link"></i> Gerenciar Links</h3>
                    <div class="text-center mb-20">
                        <button class="btn btn-primary" id="addLinkBtn">
                            <i class="fas fa-plus-circle"></i> Adicionar Link
                        </button>
                    </div>
                    <div id="adminLinksContainer"></div>
                </div>
                
                <div class="glass-card">
                    <h3 class="card-title"><i class="fas fa-file-alt"></i> Gerenciar Orientações</h3>
                    <div class="text-center mb-20">
                        <button class="btn btn-primary" id="addOrientationBtn">
                            <i class="fas fa-plus-circle"></i> Adicionar Orientação
                        </button>
                    </div>
                    <div id="adminOrientationsContainer"></div>
                </div>
            </div>

            <!-- Configurações -->
            <div id="settings" class="tab-content">
                <div class="glass-card mb-20">
                    <h3 class="card-title"><i class="fas fa-database"></i> Banco de Dados</h3>
                    <div class="text-center">
                        <button class="btn btn-secondary" id="backupBtn">
                            <i class="fas fa-download"></i> Fazer Backup
                        </button>
                        <button class="btn btn-outline" id="restoreBtn">
                            <i class="fas fa-upload"></i> Restaurar Backup
                        </button>
                        <button class="btn btn-danger" id="clearDataBtn">
                            <i class="fas fa-trash"></i> Limpar Dados Locais
                        </button>
                    </div>
                </div>
                
                <div class="glass-card">
                    <h3 class="card-title"><i class="fas fa-sync-alt"></i> Sincronização</h3>
                    <div id="syncStatus" class="alert">
                        <i class="fas fa-sync"></i>
                        <div>
                            <strong>Sincronização Ativa</strong>
                            <p>Dados sincronizados com a nuvem em tempo real</p>
                        </div>
                    </div>
                    <div class="text-center">
                        <button class="btn btn-primary" id="forceSyncBtn">
                            <i class="fas fa-sync-alt"></i> Forçar Sincronização
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Adicionar/Editar Cliente -->
    <div id="clientModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="clientModalTitle">Adicionar Cliente</h2>
                <button class="modal-close" id="closeClientModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="clientForm">
                    <div class="form-group">
                        <label class="form-label" for="modalClientName">Nome Completo</label>
                        <input type="text" id="modalClientName" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="modalClientCpf">CPF</label>
                        <input type="text" id="modalClientCpf" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="modalClientEmail">E-mail</label>
                        <input type="email" id="modalClientEmail" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="modalClientPassword">Senha</label>
                        <input type="password" id="modalClientPassword" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="modalClientStatus">Status</label>
                        <select id="modalClientStatus" class="form-control">
                            <option value="active">Ativo</option>
                            <option value="inactive">Inativo</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="modalClientProject">Projeto Vinculado</label>
                        <select id="modalClientProject" class="form-control">
                            <option value="">Nenhum</option>
                        </select>
                    </div>
                    <input type="hidden" id="modalClientId">
                    <div class="text-center">
                        <button type="submit" class="btn btn-primary" style="width: 100%;">
                            <i class="fas fa-save"></i> Salvar Cliente
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal para Adicionar/Editar Projeto -->
    <div id="projectModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="projectModalTitle">Adicionar Projeto</h2>
                <button class="modal-close" id="closeProjectModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="projectForm">
                    <div class="form-group">
                        <label class="form-label" for="modalProjectName">Nome do Projeto</label>
                        <input type="text" id="modalProjectName" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="modalProjectClient">Cliente</label>
                        <select id="modalProjectClient" class="form-control" required>
                            <option value="">Selecione um cliente</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="modalProjectDescription">Descrição</label>
                        <textarea id="modalProjectDescription" class="form-control" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="modalProjectProgress">Progresso (%)</label>
                        <input type="range" id="modalProjectProgress" class="form-control" min="0" max="100" value="0">
                        <span id="modalProjectProgressValue">0%</span>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="modalProjectStatus">Status</label>
                        <select id="modalProjectStatus" class="form-control">
                            <option value="planning">Planejamento</option>
                            <option value="in_progress">Em Andamento</option>
                            <option value="review">Em Revisão</option>
                            <option value="completed">Concluído</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="modalProjectDeadline">Prazo Final</label>
                        <input type="date" id="modalProjectDeadline" class="form-control">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="modalProjectStages">Etapas (uma por linha)</label>
                        <textarea id="modalProjectStages" class="form-control" rows="5" placeholder="Exemplo:
1. Briefing
2. Design
3. Desenvolvimento
4. Revisão
5. Entrega"></textarea>
                    </div>
                    <input type="hidden" id="modalProjectId">
                    <div class="text-center">
                        <button type="submit" class="btn btn-primary" style="width: 100%;">
                            <i class="fas fa-save"></i> Salvar Projeto
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal para Adicionar Conteúdo -->
    <div id="contentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="contentModalTitle">Adicionar Conteúdo</h2>
                <button class="modal-close" id="closeContentModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="contentForm">
                    <div class="form-group">
                        <label class="form-label" for="modalContentType">Tipo de Conteúdo</label>
                        <select id="modalContentType" class="form-control">
                            <option value="link">Link</option>
                            <option value="orientation">Orientação</option>
                            <option value="alert">Alerta</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="modalContentTitle">Título</label>
                        <input type="text" id="modalContentTitle" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="modalContentDescription">Descrição</label>
                        <textarea id="modalContentDescription" class="form-control" rows="3"></textarea>
                    </div>
                    <div class="form-group" id="modalContentUrlGroup">
                        <label class="form-label" for="modalContentUrl">URL/Link</label>
                        <input type="url" id="modalContentUrl" class="form-control">
                    </div>
                    <div class="form-group" id="modalContentIconGroup">
                        <label class="form-label" for="modalContentIcon">Ícone (FontAwesome)</label>
                        <input type="text" id="modalContentIcon" class="form-control" placeholder="Ex: fas fa-link">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="modalContentClient">Cliente (deixe vazio para todos)</label>
                        <select id="modalContentClient" class="form-control">
                            <option value="">Todos os Clientes</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="modalContentStatus">Status</label>
                        <select id="modalContentStatus" class="form-control">
                            <option value="active">Ativo</option>
                            <option value="inactive">Inativo</option>
                        </select>
                    </div>
                    <input type="hidden" id="modalContentId">
                    <div class="text-center">
                        <button type="submit" class="btn btn-primary" style="width: 100%;">
                            <i class="fas fa-save"></i> Salvar Conteúdo
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Alerta em Massa -->
    <div id="bulkAlertModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-broadcast-tower"></i> Alerta em Massa</h2>
                <button class="modal-close" id="closeBulkAlertModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="bulkAlertForm">
                    <div class="form-group">
                        <label class="form-label" for="bulkAlertTitle">Título do Alerta</label>
                        <input type="text" id="bulkAlertTitle" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="bulkAlertMessage">Mensagem</label>
                        <textarea id="bulkAlertMessage" class="form-control" rows="4" required></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="bulkAlertType">Tipo</label>
                        <select id="bulkAlertType" class="form-control">
                            <option value="info">Informação</option>
                            <option value="warning">Aviso</option>
                            <option value="danger">Urgente</option>
                            <option value="success">Sucesso</option>
                        </select>
                    </div>
                    <div class="text-center">
                        <button type="submit" class="btn btn-primary" style="width: 100%;">
                            <i class="fas fa-paper-plane"></i> Enviar para Todos os Clientes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Sistema Administrativo LG Plataforma
        document.addEventListener('DOMContentLoaded', function() {
            // Configuração do IndexedDB
            const DB_NAME = 'portallegacy';
            const DB_VERSION = 5;
            
            // Stores do banco de dados
            const STORES = {
                CLIENTS: 'clients',
                PROJECTS: 'projects',
                LINKS: 'links',
                ORIENTATIONS: 'orientations',
                DEADLINES: 'deadlines',
                ALERTS: 'alerts',
                FILES: 'files',
                ACCESSES: 'accesses',
                ADMIN: 'admin',
                SETTINGS: 'settings'
            };
            
            let db = null;
            let currentUser = null;
            
            // Inicialização do Supabase - APENAS UMA INSTÂNCIA
            const SUPABASE_URL = 'https://ledpqcynvqbdbccebhbo.supabase.co';
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxlZHBxY3ludnFiZGJjY2ViaGJvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAzODc3MjgsImV4cCI6MjA4NTk2MzcyOH0.s8GOzp4woujGuDc4vK9QXIf3cWLMENUnJfE4lt_YhLg';
            
            // Cria uma única instância do Supabase e a compartilha
            window.supabase = window.supabaseClient = supabase.createClient(
                SUPABASE_URL,
                SUPABASE_ANON_KEY
            );
            
            // Inicialização do sistema
            initSystem();
            
            // Função para inicializar o sistema
            async function initSystem() {
                try {
                    await initDatabase();
                    setupEventListeners();
                    checkAutoLogin();
                } catch (error) {
                    console.error('Erro ao inicializar o sistema:', error);
                    showMessage('Erro ao inicializar o sistema. Por favor, recarregue a página.', 'danger');
                }
            }
            
            // Inicializar o banco de dados IndexedDB
            function initDatabase() {
                return new Promise((resolve, reject) => {
                    const request = indexedDB.open(DB_NAME, DB_VERSION);
                    
                    request.onerror = (event) => {
                        console.error('Erro ao abrir o banco de dados:', event.target.error);
                        reject(event.target.error);
                    };
                    
                    request.onsuccess = (event) => {
                        db = event.target.result;
                        console.log('Banco de dados inicializado com sucesso');
                        resolve();
                    };
                    
                    request.onupgradeneeded = (event) => {
                        const database = event.target.result;
                        
                        console.log('Criando/atualizando banco de dados');
                        
                        // Criar todas as stores se não existirem
                        const storeNames = database.objectStoreNames;
                        
                        if (!storeNames.contains(STORES.CLIENTS)) {
                            database.createObjectStore(STORES.CLIENTS, { keyPath: 'id', autoIncrement: true });
                        }
                        
                        if (!storeNames.contains(STORES.PROJECTS)) {
                            database.createObjectStore(STORES.PROJECTS, { keyPath: 'id', autoIncrement: true });
                        }
                        
                        if (!storeNames.contains(STORES.LINKS)) {
                            database.createObjectStore(STORES.LINKS, { keyPath: 'id', autoIncrement: true });
                        }
                        
                        if (!storeNames.contains(STORES.ORIENTATIONS)) {
                            database.createObjectStore(STORES.ORIENTATIONS, { keyPath: 'id', autoIncrement: true });
                        }
                        
                        if (!storeNames.contains(STORES.ALERTS)) {
                            database.createObjectStore(STORES.ALERTS, { keyPath: 'id', autoIncrement: true });
                        }
                        
                        if (!storeNames.contains(STORES.FILES)) {
                            database.createObjectStore(STORES.FILES, { keyPath: 'id', autoIncrement: true });
                        }
                        
                        if (!storeNames.contains(STORES.ACCESSES)) {
                            database.createObjectStore(STORES.ACCESSES, { keyPath: 'id', autoIncrement: true });
                        }
                        
                        if (!storeNames.contains(STORES.SETTINGS)) {
                            database.createObjectStore(STORES.SETTINGS, { keyPath: 'id', autoIncrement: true });
                        }
                       
                        if (!storeNames.contains(STORES.DEADLINES)) {
                           database.createObjectStore(STORES.DEADLINES, { keyPath: 'id', autoIncrement: true });
                        }

                        if (!storeNames.contains(STORES.ADMIN)) {
                        database.createObjectStore(STORES.ADMIN, { keyPath: 'id', autoIncrement: true });
                        }
                    };
                });
            }
            
            // Configurar ouvintes de eventos
            function setupEventListeners() {
                // Login
                document.getElementById('adminLoginForm').addEventListener('submit', handleAdminLogin);
                
                // Logout
                document.getElementById('adminLogout').addEventListener('click', logout);
                
                // Tabs do admin
                document.querySelectorAll('#adminTabs .tab').forEach(tab => {
                    tab.addEventListener('click', switchAdminTab);
                });
                
                // Botões do admin
                document.getElementById('addClientBtn').addEventListener('click', () => openClientModal());
                document.getElementById('addProjectBtn').addEventListener('click', () => openProjectModal());
                document.getElementById('addAlertBtn').addEventListener('click', () => openContentModal('alert'));
                document.getElementById('addLinkBtn').addEventListener('click', () => openContentModal('link'));
                document.getElementById('addOrientationBtn').addEventListener('click', () => openContentModal('orientation'));
                document.getElementById('sendBulkAlertBtn').addEventListener('click', openBulkAlertModal);
                document.getElementById('exportClientsBtn').addEventListener('click', exportClients);
                document.getElementById('forceSyncBtn').addEventListener('click', forceSync);
                document.getElementById('clearDataBtn').addEventListener('click', clearLocalData);
                document.getElementById('backupBtn').addEventListener('click', backupData);
                
                // Modais
                document.getElementById('closeClientModal').addEventListener('click', () => closeModal('clientModal'));
                document.getElementById('closeProjectModal').addEventListener('click', () => closeModal('projectModal'));
                document.getElementById('closeContentModal').addEventListener('click', () => closeModal('contentModal'));
                document.getElementById('closeBulkAlertModal').addEventListener('click', () => closeModal('bulkAlertModal'));
                
                // Formulários modais
                document.getElementById('clientForm').addEventListener('submit', handleClientFormSubmit);
                document.getElementById('projectForm').addEventListener('submit', handleProjectFormSubmit);
                document.getElementById('contentForm').addEventListener('submit', handleContentFormSubmit);
                document.getElementById('bulkAlertForm').addEventListener('submit', handleBulkAlertSubmit);
                
                // Alterar tipo de conteúdo no modal
                document.getElementById('modalContentType').addEventListener('change', updateContentModalFields);
                
                // Atualizar valor do progresso do projeto
                document.getElementById('modalProjectProgress').addEventListener('input', function() {
                    document.getElementById('modalProjectProgressValue').textContent = this.value + '%';
                });
            }
            
            // Funções de navegação
            function showLoginScreen() {
                document.getElementById('loginScreen').classList.remove('hidden');
                document.getElementById('adminArea').classList.add('hidden');
                resetLoginForm();
            }
            
            function showAdminArea() {
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('adminArea').classList.remove('hidden');
                loadAdminData();
            }
            
            // Funções de login
            async function handleAdminLogin(e) {
                e.preventDefault();
                const email = document.getElementById('adminEmail').value;
                const password = document.getElementById('adminPassword').value;
                
                try {
                    const { data, error } = await supabase.auth.signInWithPassword({
                        email: email,
                        password: password
                    });
                    
                    if (error) throw error;
                    
                    // Login bem-sucedido
                    currentUser = {
                        id: data.user.id,
                        email: data.user.email,
                        nome: data.user.user_metadata?.name || 'Administrador',
                        criadoEm: data.user.created_at
                    };
                    
                    // Atualizar informações do usuário
                    document.getElementById('adminName').textContent = currentUser.nome;
                    document.getElementById('adminEmailDisplay').textContent = currentUser.email;
                    document.getElementById('adminAvatar').textContent = getInitials(currentUser.nome);
                    
                    // Salvar sessão
                    localStorage.setItem('lg_admin_session', JSON.stringify({
                        id: currentUser.id,
                        email: currentUser.email,
                        timestamp: new Date().getTime()
                    }));
                    
                    showAdminArea();
                } catch (error) {
                    console.error('Erro no login:', error);
                    showLoginMessage('Credenciais inválidas ou erro de conexão', 'danger');
                }
            }
            
            async function checkAutoLogin() {
                // Verificar se há sessão ativa no Supabase
                try {
                    const { data: { session } } = await supabase.auth.getSession();
                    if (session) {
                        const user = session.user;
                        currentUser = {
                            id: user.id,
                            email: user.email,
                            nome: user.user_metadata?.name || 'Administrador',
                            criadoEm: user.created_at
                        };
                        
                        document.getElementById('adminName').textContent = currentUser.nome;
                        document.getElementById('adminEmailDisplay').textContent = currentUser.email;
                        document.getElementById('adminAvatar').textContent = getInitials(currentUser.nome);
                        
                        showAdminArea();
                        return;
                    }
                } catch (error) {
                    console.error('Erro ao verificar sessão:', error);
                }
                
                // Verificar se há sessão local
                const adminSession = localStorage.getItem('lg_admin_session');
                if (adminSession) {
                    try {
                        const session = JSON.parse(adminSession);
                        // Verificar se a sessão expirou (24 horas)
                        if (new Date().getTime() - session.timestamp < 24 * 60 * 60 * 1000) {
                            // Tentar restaurar sessão do Supabase
                            try {
                                const { data: { session: supabaseSession } } = await supabase.auth.getSession();
                                if (supabaseSession && supabaseSession.user.email === session.email) {
                                    const user = supabaseSession.user;
                                    currentUser = {
                                        id: user.id,
                                        email: user.email,
                                        nome: user.user_metadata?.name || 'Administrador',
                                        criadoEm: user.created_at
                                    };
                                    
                                    document.getElementById('adminName').textContent = currentUser.nome;
                                    document.getElementById('adminEmailDisplay').textContent = currentUser.email;
                                    document.getElementById('adminAvatar').textContent = getInitials(currentUser.nome);
                                    
                                    showAdminArea();
                                }
                            } catch (error) {
                                console.error('Erro ao restaurar sessão:', error);
                            }
                        }
                    } catch (error) {
                        console.error('Erro ao analisar sessão:', error);
                    }
                }
            }
            
            function logout() {
                supabase.auth.signOut();
                currentUser = null;
                localStorage.removeItem('lg_admin_session');
                showLoginScreen();
            }
            
            // Funções para carregar dados
            async function loadAdminData() {
                try {
                    // Carregar estatísticas
                    const clientes = await getAllClients();
                    const projetos = await getAllProjects();
                    const alertas = await getAllAlerts();
                    const prazos = await getAllDeadlines();
                    
                    // Atualizar contadores
                    const activeClients = clientes.filter(c => c.status === 'active').length;
                    const activeProjects = projetos.filter(p => p.status !== 'completed').length;
                    const activeAlerts = alertas.filter(a => a.status === 'active').length;
                    
                    const today = new Date().toISOString().split('T')[0];
                    const todayDeadlines = prazos.filter(p => p.data === today && p.status !== 'concluido').length;
                    
                    document.getElementById('activeClientsCount').textContent = activeClients;
                    document.getElementById('activeProjectsCount').textContent = activeProjects;
                    document.getElementById('todayDeadlinesCount').textContent = todayDeadlines;
                    document.getElementById('activeAlertsCount').textContent = activeAlerts;
                    
                    // Carregar tabela de clientes
                    await loadClientsTable();
                    
                    // Carregar tabela de projetos
                    await loadProjectsTable();
                    
                    // Carregar alertas do admin
                    await loadAdminAlerts();
                    
                    // Carregar links do admin
                    await loadAdminLinks();
                    
                    // Carregar orientações do admin
                    await loadAdminOrientations();
                } catch (error) {
                    console.error('Erro ao carregar dados:', error);
                    showMessage('Erro ao carregar dados administrativos.', 'danger');
                }
            }
            
            async function loadClientsTable() {
                try {
                    const clients = await getAllClients();
                    const projetos = await getAllProjects();
                    const container = document.getElementById('clientsTableBody');
                    
                    if (clients.length === 0) {
                        container.innerHTML = '<tr><td colspan="7" class="text-center">Nenhum cliente cadastrado</td></tr>';
                        return;
                    }
                    
                    container.innerHTML = clients.map(client => {
                        const projeto = projetos.find(p => p.id === client.projetoId);
                        const lastAccess = client.ultimoAcesso ? formatDate(client.ultimoAcesso) : 'Nunca acessou';
                        
                        return `
                            <tr>
                                <td>${client.nome}</td>
                                <td>${formatCpf(client.cpf)}</td>
                                <td>${client.email || 'N/A'}</td>
                                <td>
                                    <span class="status-indicator">
                                        <span class="status-dot ${client.status}"></span>
                                        ${client.status === 'active' ? 'Ativo' : 'Inativo'}
                                    </span>
                                </td>
                                <td>${projeto ? projeto.nome : 'Nenhum'}</td>
                                <td>${lastAccess}</td>
                                <td>
                                    <button class="btn btn-outline" onclick="editClient(${client.id})" style="padding: 6px 12px; font-size: 14px;">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-outline" onclick="toggleClientStatus(${client.id}, '${client.status}')" style="padding: 6px 12px; font-size: 14px;">
                                        <i class="fas fa-${client.status === 'active' ? 'ban' : 'check'}"></i>
                                    </button>
                                </td>
                            </tr>
                        `;
                    }).join('');
                } catch (error) {
                    console.error('Erro ao carregar tabela de clientes:', error);
                    showMessage('Erro ao carregar clientes', 'danger');
                }
            }
            
            async function loadProjectsTable() {
                try {
                    const projects = await getAllProjects();
                    const clients = await getAllClients();
                    const container = document.getElementById('projectsTableBody');
                    
                    if (projects.length === 0) {
                        container.innerHTML = '<tr><td colspan="6" class="text-center">Nenhum projeto cadastrado</td></tr>';
                        return;
                    }
                    
                    container.innerHTML = projects.map(project => {
                        const client = clients.find(c => c.id === project.clienteId);
                        const statusText = {
                            'planning': 'Planejamento',
                            'in_progress': 'Em Andamento',
                            'review': 'Em Revisão',
                            'completed': 'Concluído'
                        };
                        
                        return `
                            <tr>
                                <td>${project.nome}</td>
                                <td>${client ? client.nome : 'Cliente não encontrado'}</td>
                                <td>
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <div class="progress-bar" style="height: 8px; flex: 1; background: rgba(100, 100, 150, 0.2); border-radius: 4px; overflow: hidden;">
                                            <div class="progress-fill" style="width: ${project.progresso}%; height: 100%; background: linear-gradient(90deg, var(--primary), var(--secondary));"></div>
                                        </div>
                                        <span>${project.progresso}%</span>
                                    </div>
                                </td>
                                <td>
                                    <span class="badge ${getProjectStatusBadge(project.status)}">
                                        ${statusText[project.status] || project.status}
                                    </span>
                                </td>
                                <td>${project.prazoFinal ? formatDate(project.prazoFinal) : 'Não definido'}</td>
                                <td>
                                    <button class="btn btn-outline" onclick="editProject(${project.id})" style="padding: 6px 12px; font-size: 14px;">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-outline" onclick="deleteProject(${project.id})" style="padding: 6px 12px; font-size: 14px;">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        `;
                    }).join('');
                } catch (error) {
                    console.error('Erro ao carregar tabela de projetos:', error);
                    showMessage('Erro ao carregar projetos', 'danger');
                }
            }
            
            async function loadAdminAlerts() {
                try {
                    const alerts = await getAllAlerts();
                    const container = document.getElementById('adminAlertsContainer');
                    
                    if (alerts.length === 0) {
                        container.innerHTML = '<div class="alert"><i class="fas fa-info-circle"></i> Nenhum alerta criado.</div>';
                        return;
                    }
                    
                    container.innerHTML = alerts.map(alert => {
                        const client = alert.clienteId ? 'Cliente específico' : 'Todos os clientes';
                        const alertTypeClass = {
                            'info': '',
                            'warning': 'alert-warning',
                            'danger': 'alert-danger',
                            'success': 'alert-success'
                        }[alert.tipo] || '';
                        
                        return `
                            <div class="glass-card mb-20">
                                <div style="display: flex; justify-content: space-between; align-items: start;">
                                    <div>
                                        <h4><i class="${alert.icone || getAlertIcon(alert.tipo)}"></i> ${alert.titulo}</h4>
                                        <p>${alert.descricao}</p>
                                        <small>Para: ${client} • Criado em: ${formatDate(alert.criadoEm)}</small>
                                    </div>
                                    <div>
                                        <button class="btn btn-outline" onclick="editContent(${alert.id}, 'alert')" style="padding: 6px 12px; font-size: 14px;">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-outline" onclick="toggleContentStatus(${alert.id}, 'alert')" style="padding: 6px 12px; font-size: 14px;">
                                            <i class="fas fa-${alert.status === 'active' ? 'ban' : 'check'}"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                } catch (error) {
                    console.error('Erro ao carregar alertas:', error);
                }
            }
            
            async function loadAdminLinks() {
                try {
                    const links = await getAllLinks();
                    const container = document.getElementById('adminLinksContainer');
                    
                    if (links.length === 0) {
                        container.innerHTML = '<p class="text-center">Nenhum link criado.</p>';
                        return;
                    }
                    
                    container.innerHTML = links.map(link => {
                        const client = link.clienteId ? 'Cliente específico' : 'Todos os clientes';
                        
                        return `
                            <div class="list-item">
                                <div class="list-icon">
                                    <i class="${link.icone || 'fas fa-link'}"></i>
                                </div>
                                <div style="flex: 1;">
                                    <strong>${link.titulo}</strong>
                                    <p>${link.descricao || ''}</p>
                                    <div style="display: flex; justify-content: space-between;">
                                        <small>${client} • URL: ${link.url ? link.url.substring(0, 50) + '...' : 'N/A'}</small>
                                        <span class="badge ${link.status === 'active' ? 'badge-success' : 'badge-danger'}">
                                            ${link.status === 'active' ? 'Ativo' : 'Inativo'}
                                        </span>
                                    </div>
                                </div>
                                <div>
                                    <button class="btn btn-outline" onclick="editContent(${link.id}, 'link')" style="padding: 6px 12px; font-size: 14px;">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-outline" onclick="toggleContentStatus(${link.id}, 'link')" style="padding: 6px 12px; font-size: 14px;">
                                        <i class="fas fa-${link.status === 'active' ? 'ban' : 'check'}"></i>
                                    </button>
                                </div>
                            </div>
                        `;
                    }).join('');
                } catch (error) {
                    console.error('Erro ao carregar links:', error);
                }
            }
            
            async function loadAdminOrientations() {
                try {
                    const orientations = await getAllOrientations();
                    const container = document.getElementById('adminOrientationsContainer');
                    
                    if (orientations.length === 0) {
                        container.innerHTML = '<p class="text-center">Nenhuma orientação criada.</p>';
                        return;
                    }
                    
                    container.innerHTML = orientations.map(orientation => {
                        const client = orientation.clienteId ? 'Cliente específico' : 'Todos os clientes';
                        
                        return `
                            <div class="glass-card mb-20">
                                <div style="display: flex; justify-content: space-between; align-items: start;">
                                    <div>
                                        <h4><i class="${orientation.icone || 'fas fa-info-circle'}"></i> ${orientation.titulo}</h4>
                                        <p>${orientation.descricao}</p>
                                        ${orientation.conteudo ? `<div style="margin-top: 10px;">${orientation.conteudo}</div>` : ''}
                                        <small>Para: ${client} • Atualizado em: ${formatDate(orientation.atualizadoEm)}</small>
                                    </div>
                                    <div>
                                        <button class="btn btn-outline" onclick="editContent(${orientation.id}, 'orientation')" style="padding: 6px 12px; font-size: 14px;">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-outline" onclick="toggleContentStatus(${orientation.id}, 'orientation')" style="padding: 6px 12px; font-size: 14px;">
                                            <i class="fas fa-${orientation.status === 'active' ? 'ban' : 'check'}"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                } catch (error) {
                    console.error('Erro ao carregar orientações:', error);
                }
            }
            
            // Funções dos modais
            async function openClientModal(clientId = null) {
                try {
                    const modal = document.getElementById('clientModal');
                    const title = document.getElementById('clientModalTitle');
                    const form = document.getElementById('clientForm');
                    
                    form.reset();
                    
                    const projects = await getAllProjects();
                    const projectSelect = document.getElementById('modalClientProject');
                    projectSelect.innerHTML = '<option value="">Nenhum</option>' + 
                        projects.map(p => `<option value="${p.id}">${p.nome}</option>`).join('');
                    
                    if (clientId) {
                        title.textContent = 'Editar Cliente';
                        const client = await getClientById(clientId);
                        
                        if (client) {
                            document.getElementById('modalClientId').value = client.id;
                            document.getElementById('modalClientName').value = client.nome;
                            document.getElementById('modalClientCpf').value = client.cpf;
                            document.getElementById('modalClientEmail').value = client.email || '';
                            document.getElementById('modalClientPassword').value = client.senha || '';
                            document.getElementById('modalClientStatus').value = client.status;
                            document.getElementById('modalClientProject').value = client.projetoId || '';
                        }
                    } else {
                        title.textContent = 'Adicionar Cliente';
                        document.getElementById('modalClientId').value = '';
                        document.getElementById('modalClientPassword').value = generatePassword();
                    }
                    
                    modal.classList.add('active');
                } catch (error) {
                    console.error('Erro ao abrir modal de cliente:', error);
                    showMessage('Erro ao abrir formulário de cliente.', 'danger');
                }
            }
            
            async function openProjectModal(projectId = null) {
                try {
                    const modal = document.getElementById('projectModal');
                    const title = document.getElementById('projectModalTitle');
                    const form = document.getElementById('projectForm');
                    
                    form.reset();
                    
                    const clients = await getAllClients();
                    const clientSelect = document.getElementById('modalProjectClient');
                    clientSelect.innerHTML = '<option value="">Selecione um cliente</option>' + 
                        clients.map(c => `<option value="${c.id}">${c.nome} (${formatCpf(c.cpf)})</option>`).join('');
                    
                    if (projectId) {
                        title.textContent = 'Editar Projeto';
                        const project = await getProjectById(projectId);
                        
                        if (project) {
                            document.getElementById('modalProjectId').value = project.id;
                            document.getElementById('modalProjectName').value = project.nome;
                            document.getElementById('modalProjectClient').value = project.clienteId;
                            document.getElementById('modalProjectDescription').value = project.descricao || '';
                            document.getElementById('modalProjectProgress').value = project.progresso;
                            document.getElementById('modalProjectProgressValue').textContent = project.progresso + '%';
                            document.getElementById('modalProjectStatus').value = project.status;
                            document.getElementById('modalProjectDeadline').value = project.prazoFinal || '';
                            document.getElementById('modalProjectStages').value = project.etapas ? project.etapas.join('\n') : '';
                        }
                    } else {
                        title.textContent = 'Adicionar Projeto';
                        document.getElementById('modalProjectId').value = '';
                        document.getElementById('modalProjectProgressValue').textContent = '0%';
                    }
                    
                    modal.classList.add('active');
                } catch (error) {
                    console.error('Erro ao abrir modal de projeto:', error);
                    showMessage('Erro ao abrir formulário de projeto.', 'danger');
                }
            }
            
            async function openContentModal(contentType = 'link', contentId = null) {
                try {
                    const modal = document.getElementById('contentModal');
                    const title = document.getElementById('contentModalTitle');
                    const form = document.getElementById('contentForm');
                    const typeSelect = document.getElementById('modalContentType');
                    
                    form.reset();
                    
                    typeSelect.value = contentType;
                    updateContentModalFields();
                    
                    const clients = await getAllClients();
                    const clientSelect = document.getElementById('modalContentClient');
                    clientSelect.innerHTML = '<option value="">Todos os Clientes</option>' + 
                        clients.map(c => `<option value="${c.id}">${c.nome}</option>`).join('');
                    
                    if (contentId) {
                        title.textContent = 'Editar Conteúdo';
                        
                        let content;
                        switch(contentType) {
                            case 'link':
                                content = await getLinkById(contentId);
                                break;
                            case 'orientation':
                                content = await getOrientationById(contentId);
                                break;
                            case 'alert':
                                content = await getAlertById(contentId);
                                break;
                        }
                        
                        if (content) {
                            document.getElementById('modalContentId').value = content.id;
                            document.getElementById('modalContentTitle').value = content.titulo;
                            document.getElementById('modalContentDescription').value = content.descricao || '';
                            document.getElementById('modalContentUrl').value = content.url || '';
                            document.getElementById('modalContentIcon').value = content.icone || '';
                            document.getElementById('modalContentClient').value = content.clienteId || '';
                            document.getElementById('modalContentStatus').value = content.status || 'active';
                        }
                    } else {
                        title.textContent = 'Adicionar Conteúdo';
                        document.getElementById('modalContentId').value = '';
                        
                        const defaultIcons = {
                            'link': 'fas fa-link',
                            'orientation': 'fas fa-info-circle',
                            'alert': 'fas fa-bell'
                        };
                        
                        document.getElementById('modalContentIcon').value = defaultIcons[contentType] || 'fas fa-question-circle';
                    }
                    
                    modal.classList.add('active');
                } catch (error) {
                    console.error('Erro ao abrir modal de conteúdo:', error);
                    showMessage('Erro ao abrir formulário de conteúdo.', 'danger');
                }
            }
            
            function openBulkAlertModal() {
                document.getElementById('bulkAlertModal').classList.add('active');
            }
            
            function updateContentModalFields() {
                const type = document.getElementById('modalContentType').value;
                const urlGroup = document.getElementById('modalContentUrlGroup');
                const iconGroup = document.getElementById('modalContentIconGroup');
                
                if (type === 'link') {
                    urlGroup.style.display = 'block';
                    iconGroup.style.display = 'block';
                } else {
                    urlGroup.style.display = 'none';
                    iconGroup.style.display = 'block';
                }
            }
            
            function closeModal(modalId) {
                document.getElementById(modalId).classList.remove('active');
            }
            
            // Funções dos formulários
            async function handleClientFormSubmit(e) {
                e.preventDefault();
                
                const clientData = {
                    nome: document.getElementById('modalClientName').value,
                    cpf: document.getElementById('modalClientCpf').value,
                    email: document.getElementById('modalClientEmail').value,
                    senha: document.getElementById('modalClientPassword').value,
                    status: document.getElementById('modalClientStatus').value,
                    projetoId: document.getElementById('modalClientProject').value || null,
                    criadoEm: new Date().toISOString(),
                    ultimoAcesso: null
                };
                
                const clientId = document.getElementById('modalClientId').value;
                
                try {
                    if (clientId) {
                        const existingClient = await getClientById(parseInt(clientId));
                        if (existingClient) {
                            clientData.id = parseInt(clientId);
                            clientData.criadoEm = existingClient.criadoEm;
                            await updateClient(clientData);
                            showMessage('Cliente atualizado com sucesso!', 'success');
                        }
                    } else {
                        await addClient(clientData);
                        showMessage('Cliente adicionado com sucesso!', 'success');
                    }
                    
                    closeModal('clientModal');
                    await loadAdminData();
                    
                } catch (error) {
                    showMessage(`Erro: ${error.message}`, 'danger');
                }
            }
            
            async function handleProjectFormSubmit(e) {
                e.preventDefault();
                
                const stagesText = document.getElementById('modalProjectStages').value;
                const stages = stagesText.split('\n').filter(stage => stage.trim() !== '');
                
                const projectData = {
                    nome: document.getElementById('modalProjectName').value,
                    clienteId: parseInt(document.getElementById('modalProjectClient').value),
                    descricao: document.getElementById('modalProjectDescription').value,
                    progresso: parseInt(document.getElementById('modalProjectProgress').value),
                    status: document.getElementById('modalProjectStatus').value,
                    prazoFinal: document.getElementById('modalProjectDeadline').value || null,
                    etapas: stages,
                    dataInicio: new Date().toISOString()
                };
                
                const projectId = document.getElementById('modalProjectId').value;
                
                try {
                    if (projectId) {
                        const existingProject = await getProjectById(parseInt(projectId));
                        if (existingProject) {
                            projectData.id = parseInt(projectId);
                            projectData.dataInicio = existingProject.dataInicio;
                            await updateProject(projectData);
                            showMessage('Projeto atualizado com sucesso!', 'success');
                        }
                    } else {
                        await addProject(projectData);
                        showMessage('Projeto adicionado com sucesso!', 'success');
                    }
                    
                    closeModal('projectModal');
                    await loadAdminData();
                    
                } catch (error) {
                    showMessage(`Erro: ${error.message}`, 'danger');
                }
            }
            
            async function handleContentFormSubmit(e) {
                e.preventDefault();
                
                const type = document.getElementById('modalContentType').value;
                const contentId = document.getElementById('modalContentId').value;
                
                const contentData = {
                    titulo: document.getElementById('modalContentTitle').value,
                    descricao: document.getElementById('modalContentDescription').value,
                    icone: document.getElementById('modalContentIcon').value,
                    clienteId: document.getElementById('modalContentClient').value || null,
                    status: document.getElementById('modalContentStatus').value,
                    criadoEm: new Date().toISOString(),
                    atualizadoEm: new Date().toISOString()
                };
                
                if (type === 'link') {
                    contentData.url = document.getElementById('modalContentUrl').value;
                }
                
                if (type === 'alert') {
                    contentData.tipo = 'info';
                    contentData.data = new Date().toISOString();
                }
                
                try {
                    if (contentId) {
                        contentData.id = parseInt(contentId);
                        
                        switch(type) {
                            case 'link':
                                await updateLink(contentData);
                                break;
                            case 'orientation':
                                await updateOrientation(contentData);
                                break;
                            case 'alert':
                                await updateAlert(contentData);
                                break;
                        }
                        
                        showMessage('Conteúdo atualizado com sucesso!', 'success');
                    } else {
                        switch(type) {
                            case 'link':
                                await addLink(contentData);
                                break;
                            case 'orientation':
                                await addOrientation(contentData);
                                break;
                            case 'alert':
                                await addAlert(contentData);
                                break;
                        }
                        
                        showMessage('Conteúdo adicionado com sucesso!', 'success');
                    }
                    
                    closeModal('contentModal');
                    await loadAdminData();
                    
                } catch (error) {
                    showMessage(`Erro: ${error.message}`, 'danger');
                }
            }
            
            async function handleBulkAlertSubmit(e) {
                e.preventDefault();
                
                const title = document.getElementById('bulkAlertTitle').value;
                const message = document.getElementById('bulkAlertMessage').value;
                const type = document.getElementById('bulkAlertType').value;
                
                try {
                    const clients = await getAllClients();
                    
                    for (const client of clients) {
                        if (client.status === 'active') {
                            const alertData = {
                                titulo: title,
                                descricao: message,
                                tipo: type,
                                clienteId: client.id,
                                icone: getAlertIcon(type),
                                status: 'active',
                                criadoEm: new Date().toISOString(),
                                data: new Date().toISOString()
                            };
                            
                            await addAlert(alertData);
                        }
                    }
                    
                    closeModal('bulkAlertModal');
                    showMessage(`Alerta enviado para ${clients.filter(c => c.status === 'active').length} clientes ativos!`, 'success');
                    await loadAdminData();
                    
                } catch (error) {
                    showMessage(`Erro: ${error.message}`, 'danger');
                }
            }
            
            // Funções utilitárias
            function switchAdminTab(e) {
                const tab = e.target.getAttribute('data-tab');
                
                document.querySelectorAll('#adminTabs .tab').forEach(t => {
                    t.classList.remove('active');
                });
                e.target.classList.add('active');
                
                document.querySelectorAll('#adminArea .tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(tab).classList.add('active');
            }
            
            function showLoginMessage(message, type) {
                const messageDiv = document.getElementById('loginMessage');
                messageDiv.textContent = message;
                messageDiv.className = `alert alert-${type}`;
                messageDiv.classList.remove('hidden');
            }
            
            function showMessage(message, type) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `glass-card alert-${type}`;
                messageDiv.style.position = 'fixed';
                messageDiv.style.top = '20px';
                messageDiv.style.right = '20px';
                messageDiv.style.zIndex = '1000';
                messageDiv.style.maxWidth = '300px';
                messageDiv.style.padding = '15px';
                messageDiv.textContent = message;
                
                document.body.appendChild(messageDiv);
                
                setTimeout(() => {
                    messageDiv.remove();
                }, 5000);
            }
            
            function resetLoginForm() {
                document.getElementById('adminLoginForm').reset();
                document.getElementById('loginMessage').classList.add('hidden');
            }
            
            function formatCpf(cpf) {
                if (!cpf) return '';
                const cleaned = cpf.replace(/\D/g, '');
                if (cleaned.length !== 11) return cpf;
                return cleaned.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
            }
            
            function formatDate(dateString) {
                if (!dateString) return 'N/A';
                const date = new Date(dateString);
                return date.toLocaleDateString('pt-BR');
            }
            
            function getInitials(name) {
                return name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
            }
            
            function getAlertIcon(type) {
                const icons = {
                    'info': 'fas fa-info-circle',
                    'warning': 'fas fa-exclamation-triangle',
                    'danger': 'fas fa-times-circle',
                    'success': 'fas fa-check-circle'
                };
                return icons[type] || 'fas fa-bell';
            }
            
            function getProjectStatusBadge(status) {
                const badges = {
                    'planning': 'badge-info',
                    'in_progress': 'badge-success',
                    'review': 'badge-warning',
                    'completed': 'badge-secondary'
                };
                return badges[status] || 'badge-info';
            }
            
            function generatePassword() {
                return Math.random().toString(36).slice(-8);
            }
            
            // Funções do IndexedDB
            async function addClient(client) {
                return new Promise((resolve, reject) => {
                    const transaction = db.transaction([STORES.CLIENTS], 'readwrite');
                    const store = transaction.objectStore(STORES.CLIENTS);
                    const request = store.add(client);
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }
            
            async function updateClient(client) {
                return new Promise((resolve, reject) => {
                    const transaction = db.transaction([STORES.CLIENTS], 'readwrite');
                    const store = transaction.objectStore(STORES.CLIENTS);
                    const request = store.put(client);
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }
            
            async function getClientById(id) {
                return new Promise((resolve, reject) => {
                    const transaction = db.transaction([STORES.CLIENTS], 'readonly');
                    const store = transaction.objectStore(STORES.CLIENTS);
                    const request = store.get(id);
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }
            
            async function getAllClients() {
                return new Promise((resolve, reject) => {
                    const transaction = db.transaction([STORES.CLIENTS], 'readonly');
                    const store = transaction.objectStore(STORES.CLIENTS);
                    const request = store.getAll();
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }
            
            async function addProject(project) {
                return new Promise((resolve, reject) => {
                    const transaction = db.transaction([STORES.PROJECTS], 'readwrite');
                    const store = transaction.objectStore(STORES.PROJECTS);
                    const request = store.add(project);
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }
            
            async function updateProject(project) {
                return new Promise((resolve, reject) => {
                    const transaction = db.transaction([STORES.PROJECTS], 'readwrite');
                    const store = transaction.objectStore(STORES.PROJECTS);
                    const request = store.put(project);
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }
            
            async function getProjectById(id) {
                return new Promise((resolve, reject) => {
                    const transaction = db.transaction([STORES.PROJECTS], 'readonly');
                    const store = transaction.objectStore(STORES.PROJECTS);
                    const request = store.get(id);
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }
            
            async function getAllProjects() {
                return new Promise((resolve, reject) => {
                    const transaction = db.transaction([STORES.PROJECTS], 'readonly');
                    const store = transaction.objectStore(STORES.PROJECTS);
                    const request = store.getAll();
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }
            
            async function addLink(link) {
                return new Promise((resolve, reject) => {
                    const transaction = db.transaction([STORES.LINKS], 'readwrite');
                    const store = transaction.objectStore(STORES.LINKS);
                    const request = store.add(link);
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }
            
            async function updateLink(link) {
                return new Promise((resolve, reject) => {
                    const transaction = db.transaction([STORES.LINKS], 'readwrite');
                    const store = transaction.objectStore(STORES.LINKS);
                    const request = store.put(link);
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }
            
            async function getLinkById(id) {
                return new Promise((resolve, reject) => {
                    const transaction = db.transaction([STORES.LINKS], 'readonly');
                    const store = transaction.objectStore(STORES.LINKS);
                    const request = store.get(id);
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }
            
            async function getAllLinks() {
                return new Promise((resolve, reject) => {
                    const transaction = db.transaction([STORES.LINKS], 'readonly');
                    const store = transaction.objectStore(STORES.LINKS);
                    const request = store.getAll();
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }
            
            async function addOrientation(orientation) {
                return new Promise((resolve, reject) => {
                    const transaction = db.transaction([STORES.ORIENTATIONS], 'readwrite');
                    const store = transaction.objectStore(STORES.ORIENTATIONS);
                    const request = store.add(orientation);
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }
            
            async function updateOrientation(orientation) {
                return new Promise((resolve, reject) => {
                    const transaction = db.transaction([STORES.ORIENTATIONS], 'readwrite');
                    const store = transaction.objectStore(STORES.ORIENTATIONS);
                    const request = store.put(orientation);
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }
            
            async function getOrientationById(id) {
                return new Promise((resolve, reject) => {
                    const transaction = db.transaction([STORES.ORIENTATIONS], 'readonly');
                    const store = transaction.objectStore(STORES.ORIENTATIONS);
                    const request = store.get(id);
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }
            
            async function getAllOrientations() {
                return new Promise((resolve, reject) => {
                    const transaction = db.transaction([STORES.ORIENTATIONS], 'readonly');
                    const store = transaction.objectStore(STORES.ORIENTATIONS);
                    const request = store.getAll();
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }
            
            async function addAlert(alert) {
                return new Promise((resolve, reject) => {
                    const transaction = db.transaction([STORES.ALERTS], 'readwrite');
                    const store = transaction.objectStore(STORES.ALERTS);
                    const request = store.add(alert);
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }
            
            async function updateAlert(alert) {
                return new Promise((resolve, reject) => {
                    const transaction = db.transaction([STORES.ALERTS], 'readwrite');
                    const store = transaction.objectStore(STORES.ALERTS);
                    const request = store.put(alert);
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }
            
            async function getAlertById(id) {
                return new Promise((resolve, reject) => {
                    const transaction = db.transaction([STORES.ALERTS], 'readonly');
                    const store = transaction.objectStore(STORES.ALERTS);
                    const request = store.get(id);
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }
            
            async function getAllAlerts() {
                return new Promise((resolve, reject) => {
                    const transaction = db.transaction([STORES.ALERTS], 'readonly');
                    const store = transaction.objectStore(STORES.ALERTS);
                    const request = store.getAll();
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }
            
            async function getAllDeadlines() {
                return new Promise((resolve, reject) => {
                    const transaction = db.transaction([STORES.DEADLINES], 'readonly');
                    const store = transaction.objectStore(STORES.DEADLINES);
                    const request = store.getAll();
                    
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }
            
            // Funções de operações administrativas
            async function exportClients() {
                try {
                    const clients = await getAllClients();
                    const dataStr = JSON.stringify(clients, null, 2);
                    const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                    
                    const exportFileDefaultName = `clientes_lg_${new Date().toISOString().split('T')[0]}.json`;
                    
                    const linkElement = document.createElement('a');
                    linkElement.setAttribute('href', dataUri);
                    linkElement.setAttribute('download', exportFileDefaultName);
                    linkElement.click();
                    
                    showMessage('Clientes exportados com sucesso!', 'success');
                } catch (error) {
                    showMessage('Erro ao exportar clientes', 'danger');
                }
            }
            
            async function forceSync() {
                showMessage('Sincronização forçada iniciada...', 'info');
                // Aqui você implementaria a lógica de sincronização com o Supabase
                setTimeout(() => {
                    showMessage('Sincronização concluída!', 'success');
                }, 2000);
            }
            
            async function clearLocalData() {
                if (confirm('Tem certeza que deseja limpar todos os dados locais? Esta ação não pode ser desfeita.')) {
                    try {
                        indexedDB.deleteDatabase(DB_NAME);
                        localStorage.clear();
                        showMessage('Dados locais limpos com sucesso! Recarregando...', 'success');
                        setTimeout(() => location.reload(), 2000);
                    } catch (error) {
                        showMessage('Erro ao limpar dados', 'danger');
                    }
                }
            }
            
            async function backupData() {
                try {
                    const allData = {
                        clients: await getAllClients(),
                        projects: await getAllProjects(),
                        links: await getAllLinks(),
                        orientations: await getAllOrientations(),
                        alerts: await getAllAlerts(),
                        backupDate: new Date().toISOString()
                    };
                    
                    const dataStr = JSON.stringify(allData, null, 2);
                    const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                    
                    const exportFileDefaultName = `backup_lg_${new Date().toISOString().split('T')[0]}.json`;
                    
                    const linkElement = document.createElement('a');
                    linkElement.setAttribute('href', dataUri);
                    linkElement.setAttribute('download', exportFileDefaultName);
                    linkElement.click();
                    
                    showMessage('Backup realizado com sucesso!', 'success');
                } catch (error) {
                    showMessage('Erro ao fazer backup', 'danger');
                }
            }
            
            // Funções globais para uso nos botões
            window.editClient = async function(clientId) {
                await openClientModal(clientId);
            };
            
            window.toggleClientStatus = async function(clientId, currentStatus) {
                const client = await getClientById(clientId);
                if (client) {
                    client.status = currentStatus === 'active' ? 'inactive' : 'active';
                    await updateClient(client);
                    showMessage(`Cliente ${client.status === 'active' ? 'ativado' : 'desativado'} com sucesso!`, 'success');
                    await loadAdminData();
                }
            };
            
            window.editProject = async function(projectId) {
                await openProjectModal(projectId);
            };
            
            window.deleteProject = async function(projectId) {
                if (confirm('Tem certeza que deseja excluir este projeto?')) {
                    try {
                        // Aqui você implementaria a exclusão do projeto
                        showMessage('Projeto excluído com sucesso!', 'success');
                        await loadAdminData();
                    } catch (error) {
                        showMessage('Erro ao excluir projeto', 'danger');
                    }
                }
            };
            
            window.editContent = async function(contentId, contentType) {
                await openContentModal(contentType, contentId);
            };
            
            window.toggleContentStatus = async function(contentId, contentType) {
                let content;
                switch(contentType) {
                    case 'link':
                        content = await getLinkById(contentId);
                        if (content) {
                            content.status = content.status === 'active' ? 'inactive' : 'active';
                            await updateLink(content);
                        }
                        break;
                    case 'orientation':
                        content = await getOrientationById(contentId);
                        if (content) {
                            content.status = content.status === 'active' ? 'inactive' : 'active';
                            await updateOrientation(content);
                        }
                        break;
                    case 'alert':
                        content = await getAlertById(contentId);
                        if (content) {
                            content.status = content.status === 'active' ? 'inactive' : 'active';
                            await updateAlert(content);
                        }
                        break;
                }
                
                if (content) {
                    showMessage(`Conteúdo ${content.status === 'active' ? 'ativado' : 'desativado'} com sucesso!`, 'success');
                    await loadAdminData();
                }
            };
        });
    </script>

<script>
// Sistema de Sincronização CORRIGIDO
(function () {
    const SYNC_TABLE = 'lg_admin_sync';
    const DB_NAME = 'portallegacy';
    
    const DEVICE_ID = localStorage.getItem('admin_device_id') || (() => {
        const id = crypto.randomUUID();
        localStorage.setItem('admin_device_id', id);
        return id;
    })();
    
    const syncCache = new Map();
    
    // Configuração do Supabase - AGUARDA INICIALIZAÇÃO
    const SUPABASE_URL = 'https://ledpqcynvqbdbccebhbo.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxlZHBxY3ludnFiZGJjY2ViaGJvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAzODc3MjgsImV4cCI6MjA4NTk2MzcyOH0.s8GOzp4woujGuDc4vK9QXIf3cWLMENUnJfE4lt_YhLg';
    
    // Função para aguardar o Supabase estar pronto
    function waitForSupabase() {
        return new Promise((resolve) => {
            const check = () => {
                if (window.supabase || window.supabaseClient) {
                    resolve(window.supabase || window.supabaseClient);
                } else {
                    setTimeout(check, 100);
                }
            };
            check();
        });
    }
    
    async function getUserId() {
        try {
            const supabase = await waitForSupabase();
            const { data } = await supabase.auth.getSession();
            return data?.session?.user?.id || null;
        } catch (error) {
            console.error('Erro ao obter usuário:', error);
            return null;
        }
    }
    
    // Função para fazer push dos dados
    async function push(store, method, key, value) {
        const userId = await getUserId();
        if (!userId) return;
        
        const cacheKey = `${store}-${key}`;
        
        if (method !== 'delete') {
            const sig = JSON.stringify(value);
            if (syncCache.get(cacheKey) === sig) return;
            syncCache.set(cacheKey, sig);
        } else {
            syncCache.delete(cacheKey);
        }
        
        try {
            const supabase = await waitForSupabase();
            const { error } = await supabase
                .from(SYNC_TABLE)
                .upsert({
                    user_id: userId,
                    db_name: DB_NAME,
                    store_name: store,
                    record_key: String(key),
                    record_value: method === 'delete' ? null : value,
                    is_deleted: method === 'delete',
                    device_id: DEVICE_ID,
                    updated_at: new Date().toISOString()
                }, {
                    onConflict: 'user_id,db_name,store_name,record_key'
                });
            
            if (!error) {
                console.log('✅ Dados sincronizados:', store, key);
            }
        } catch (error) {
            console.error('❌ Erro na sincronização:', error);
        }
    }
    
    // Patch do IndexedDB para capturar alterações
    (function patchIndexedDB() {
        const originalOpen = indexedDB.open;
        
        indexedDB.open = function(name, version) {
            const request = originalOpen.call(this, name, version);
            
            request.onsuccess = function(event) {
                const db = event.target.result;
                
                // Interceptar transações
                const originalTransaction = db.transaction;
                db.transaction = function(storeNames, mode) {
                    const transaction = originalTransaction.call(this, storeNames, mode);
                    
                    if (mode === 'readwrite') {
                        const originalObjectStore = transaction.objectStore;
                        
                        transaction.objectStore = function(storeName) {
                            const store = originalObjectStore.call(this, storeName);
                            
                            // Interceptar operações
                            ['put', 'add', 'delete'].forEach(method => {
                                const originalMethod = store[method];
                                
                                store[method] = function(...args) {
                                    const result = originalMethod.apply(this, args);
                                    
                                    result.onsuccess = function() {
                                        let key, value;
                                        
                                        if (method === 'delete') {
                                            key = args[0];
                                        } else {
                                            value = args[0];
                                            key = args[1] || result.result || value?.id;
                                        }
                                        
                                        if (key !== undefined) {
                                            push(storeName, method, key, value);
                                        }
                                    };
                                    
                                    return result;
                                };
                            });
                            
                            return store;
                        };
                    }
                    
                    return transaction;
                };
            };
            
            return request;
        };
        
        console.log('🔄 Sistema de sincronização ativado');
    })();
    
    // Inicializar sincronização
    async function initSync() {
        const userId = await getUserId();
        if (!userId) {
            console.log('🔄 Aguardando autenticação para sincronização...');
            return;
        }
        
        // Sincronizar a cada 30 segundos
        setInterval(async () => {
            console.log('🔄 Verificando sincronização...');
        }, 30000);
    }
    
    // Aguardar o Supabase estar pronto e inicializar
    setTimeout(async () => {
        try {
            await waitForSupabase();
            initSync();
        } catch (error) {
            console.error('Erro ao inicializar sincronização:', error);
        }
    }, 2000);
})();
</script>
<script>
// SISTEMA DE SINCRONIZAÇÃO EM TEMPO REAL - CORRIGIDO
(function () {
    const SYNC_TABLE = 'lg_user_sync';
    const CANONICAL_DB = 'portallegacy';
    
    // Gerar ID do dispositivo
    let storedId = sessionStorage.getItem('sync_device_id');
    if (!storedId) {
        storedId = crypto.randomUUID();
        sessionStorage.setItem('sync_device_id', storedId);
    }
    const DEVICE_ID = storedId;
    
    // Variáveis de controle
    let isReplicating = false; 
    let syncInterval = null;
    const syncCache = new Map();

    // Função para obter o cliente Supabase (aguarda inicialização)
    function getClient() {
        // Tenta obter a instância unificada do Supabase
        if (window.supabase || window.supabaseClient) {
            return window.supabase || window.supabaseClient;
        }
        
        // Se não existir, cria uma nova (fallback)
        console.warn('Supabase client não encontrado, criando fallback...');
        const SUPABASE_URL = 'https://ledpqcynvqbdbccebhbo.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxlZHBxY3ludnFiZGJjY2ViaGJvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAzODc3MjgsImV4cCI6MjA4NTk2MzcyOH0.s8GOzp4woujGuDc4vK9QXIf3cWLMENUnJfE4lt_YhLg';
        
        const client = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        window.supabase = window.supabaseClient = client;
        return client;
    }

    // Função para aguardar o Supabase estar pronto
    function waitForSupabase() {
        return new Promise((resolve) => {
            const check = () => {
                const client = getClient();
                if (client && client.auth) {
                    resolve(client);
                } else {
                    setTimeout(check, 100);
                }
            };
            check();
        });
    }

    // Obter ID do usuário atual
    async function getUserId() {
        try {
            const client = await waitForSupabase();
            const { data } = await client.auth.getSession();
            return data?.session?.user?.id || null;
        } catch (error) {
            console.error('Erro ao obter ID do usuário:', error);
            return null;
        }
    }

    // Gerar assinatura para comparação
    function generateSignature(value) {
        if (value === null || value === undefined) return 'null';
        return JSON.stringify(value);
    }

    // Interceptar operações do IndexedDB
    const originalMethods = {
        put: IDBObjectStore.prototype.put,
        add: IDBObjectStore.prototype.add,
        delete: IDBObjectStore.prototype.delete
    };

    // Agendar upload em tempo real
    async function scheduleRealtimeUpload(storeName, method, key, value) {
        if (isReplicating) return;

        const client = getClient();
        const userId = await getUserId();
        if (!client || !userId) return;

        const cacheKey = `${storeName}-${key}`;
        
        // Atualiza cache local imediatamente
        if (method === 'delete') {
            syncCache.delete(cacheKey);
        } else {
            syncCache.set(cacheKey, generateSignature(value));
        }

        // Envia para o Supabase
        client.from(SYNC_TABLE).upsert({
            user_id: userId,
            db_name: CANONICAL_DB,
            store_name: storeName,
            record_key: String(key),
            record_value: method === 'delete' ? null : value,
            is_deleted: method === 'delete',
            device_id: DEVICE_ID,
            updated_at: new Date().toISOString()
        }, { onConflict: 'user_id,db_name,store_name,record_key' })
        .then(({ error }) => {
            if (error) {
                console.warn(`⚠️ Falha no upload de sincronização:`, error.message);
            } else {
                console.log(`✅ Upload: ${storeName}-${key}`);
            }
        });
    }

    // Sobrescrever métodos do IndexedDB para capturar alterações
    IDBObjectStore.prototype.put = function (value, key) {
        const request = originalMethods.put.apply(this, arguments);
        const storeName = this.name;
        request.onsuccess = (event) => {
            const resultKey = key || event.target.result;
            scheduleRealtimeUpload(storeName, 'put', resultKey, value);
        };
        return request;
    };

    IDBObjectStore.prototype.add = function (value, key) {
        const request = originalMethods.add.apply(this, arguments);
        const storeName = this.name;
        request.onsuccess = (event) => {
            const resultKey = key || event.target.result;
            scheduleRealtimeUpload(storeName, 'add', resultKey, value);
        };
        return request;
    };

    IDBObjectStore.prototype.delete = function (key) {
        const request = originalMethods.delete.apply(this, arguments);
        const storeName = this.name;
        request.onsuccess = () => {
            scheduleRealtimeUpload(storeName, 'delete', key, null);
        };
        return request;
    };

    console.log('🔄 Sistema de sincronização em tempo real ativado');

    // Loop inteligente de upload
    async function smartUploadLoop() {
        const userId = await getUserId();
        const client = getClient();
        if (!userId || !client) return;

        return new Promise((resolve) => {
            const request = indexedDB.open(CANONICAL_DB);
            
            request.onsuccess = (event) => {
                const db = event.target.result;
                const storeNames = Array.from(db.objectStoreNames);
                
                let pendingOperations = 0;
                let changedRecords = [];

                storeNames.forEach(storeName => {
                    const tx = db.transaction([storeName], 'readonly');
                    const store = tx.objectStore(storeName);
                    
                    // Obter todos os registros e chaves
                    const getAllRequest = store.getAll();
                    const getKeysRequest = store.getAllKeys();
                    
                    pendingOperations += 2;
                    
                    getAllRequest.onsuccess = (getAllEvent) => {
                        const records = getAllEvent.target.result;
                        getKeysRequest.onsuccess = (getKeysEvent) => {
                            const keys = getKeysEvent.target.result;
                            
                            records.forEach((item, index) => {
                                const key = String(keys[index]);
                                const cacheKey = `${storeName}-${key}`;
                                const currentSig = generateSignature(item);

                                if (syncCache.get(cacheKey) !== currentSig) {
                                    changedRecords.push({
                                        user_id: userId,
                                        db_name: CANONICAL_DB,
                                        store_name: storeName,
                                        record_key: key,
                                        record_value: item,
                                        is_deleted: false,
                                        device_id: DEVICE_ID,
                                        updated_at: new Date().toISOString()
                                    });
                                    syncCache.set(cacheKey, currentSig);
                                }
                            });
                            
                            pendingOperations -= 2;
                            if (pendingOperations === 0) {
                                processChangedRecords(changedRecords, client);
                                resolve();
                            }
                        };
                    };
                });
                
                if (storeNames.length === 0) {
                    resolve();
                }
            };
            
            request.onerror = () => resolve();
        });
    }

    // Processar registros alterados
    async function processChangedRecords(changedRecords, client) {
        if (changedRecords.length > 0) {
            console.log(`📤 Upload inteligente: ${changedRecords.length} itens`);
            try {
                await client.from(SYNC_TABLE).upsert(changedRecords, { 
                    onConflict: 'user_id,db_name,store_name,record_key' 
                });
            } catch (error) {
                console.error('Erro no upload inteligente:', error);
            }
        }
    }

    // Loop inteligente de download
    async function smartDownloadLoop() {
        const userId = await getUserId();
        const client = getClient();
        if (!userId || !client) return;

        try {
            const { data, error } = await client
                .from(SYNC_TABLE)
                .select('*')
                .eq('user_id', userId)
                .eq('db_name', CANONICAL_DB);

            if (error || !data || !data.length) return;

            // Processar os dados recebidos
            processDownloadedData(data);
        } catch (error) {
            console.error('Erro no download inteligente:', error);
        }
    }

    // Processar dados baixados
    function processDownloadedData(data) {
        return new Promise((resolve) => {
            const request = indexedDB.open(CANONICAL_DB);
            
            request.onsuccess = (event) => {
                const db = event.target.result;
                const localStores = Array.from(db.objectStoreNames);
                
                // Filtrar registros válidos
                const validRecords = data.filter(r => localStores.includes(r.store_name));
                if (!validRecords.length) {
                    resolve(0);
                    return;
                }

                const tx = db.transaction([...new Set(validRecords.map(r => r.store_name))], 'readwrite');
                isReplicating = true;
                
                let writes = 0;

                validRecords.forEach(record => {
                    // Ignorar registros do próprio dispositivo
                    if (record.device_id === DEVICE_ID) return;

                    const store = tx.objectStore(record.store_name);
                    const key = !isNaN(record.record_key) ? Number(record.record_key) : record.record_key;
                    const cacheKey = `${record.store_name}-${record.record_key}`;
                    
                    // Exclusão de registro
                    if (record.is_deleted) {
                        store.delete(key);
                        if (syncCache.has(cacheKey)) {
                            syncCache.delete(cacheKey);
                            writes++;
                        }
                        return;
                    }

                    // Verificar se o registro mudou
                    const incomingSig = generateSignature(record.record_value);
                    const localSig = syncCache.get(cacheKey);

                    if (incomingSig === localSig) {
                        return; // Nenhuma mudança
                    }

                    // Atualizar registro
                    const value = record.record_value;
                    if (store.keyPath && value && typeof value === 'object') {
                        if (!value[store.keyPath]) value[store.keyPath] = key;
                        store.put(value);
                    } else {
                        store.put(value, key);
                    }
                    
                    syncCache.set(cacheKey, incomingSig);
                    writes++;
                });

                tx.oncomplete = () => {
                    isReplicating = false;
                    if (writes > 0) {
                        console.log(`📥 Download sincronizado: ${writes} alterações aplicadas`);
                    }
                    resolve(writes);
                };
                
                tx.onerror = () => {
                    isReplicating = false;
                    console.error('Erro na transação de download');
                    resolve(0);
                };
            };
            
            request.onerror = () => resolve(0);
        });
    }

    // Iniciar serviço de sincronização
    async function startService() {
        try {
            const userId = await getUserId();
            if (!userId) {
                console.log('⏳ Aguardando autenticação para sincronização...');
                return;
            }

            console.log('🚀 Iniciando serviço de sincronização para usuário:', userId);
            const client = getClient();

            // Configurar canal em tempo real
            const channel = client.channel('global-sync-live')
                .on('postgres_changes', { 
                    event: '*', 
                    schema: 'public', 
                    table: SYNC_TABLE, 
                    filter: `user_id=eq.${userId}` 
                }, (payload) => {
                    // Só dispara download se o evento veio de OUTRO dispositivo
                    if (payload.new && payload.new.device_id !== DEVICE_ID) {
                        console.log('🔔 Alteração recebida em tempo real');
                        smartDownloadLoop();
                    }
                })
                .subscribe((status) => {
                    if (status === 'SUBSCRIBED') {
                        console.log('✅ Inscrito no canal de sincronização em tempo real');
                    }
                });

            // Upload inicial
            await smartUploadLoop();
            
            // Download inicial com pequeno delay
            setTimeout(smartDownloadLoop, 500);

            // Configurar sincronização periódica
            if (syncInterval) clearInterval(syncInterval);
            syncInterval = setInterval(async () => {
                await smartUploadLoop();
                await smartDownloadLoop();
            }, 10000); // Sincronizar a cada 10 segundos

        } catch (error) {
            console.error('❌ Erro ao iniciar serviço de sincronização:', error);
        }
    }

    // Parar serviço de sincronização
    function stopService() {
        if (syncInterval) {
            clearInterval(syncInterval);
            syncInterval = null;
        }
        console.log('⏹️ Serviço de sincronização parado');
    }

    // Configurar listener de autenticação
    async function setupAuthListener() {
        try {
            const client = await waitForSupabase();
            
            client.auth.onAuthStateChange((event, session) => {
                console.log('🔐 Evento de autenticação:', event, session ? 'Usuário logado' : 'Usuário deslogado');

                if (event === 'SIGNED_IN' && session) {
                    console.log('✅ Usuário autenticado, iniciando sincronização...');
                    startService();
                }

                if (event === 'SIGNED_OUT') {
                    console.log('🚪 Usuário deslogado, parando sincronização...');
                    stopService();
                }
            });
            
            // Verificar se já há uma sessão ativa
            const { data: { session } } = await client.auth.getSession();
            if (session) {
                console.log('🔍 Sessão existente encontrada');
                startService();
            }
            
        } catch (error) {
            console.error('❌ Erro ao configurar listener de autenticação:', error);
        }
    }

    // Inicializar o sistema de sincronização quando o DOM estiver pronto
    function initSyncSystem() {
        console.log('🔄 Inicializando sistema de sincronização...');
        
        // Aguardar um pouco para garantir que o Supabase esteja carregado
        setTimeout(async () => {
            try {
                await setupAuthListener();
            } catch (error) {
                console.error('❌ Falha na inicialização da sincronização:', error);
                // Tentar novamente após 3 segundos
                setTimeout(initSyncSystem, 3000);
            }
        }, 1000);
    }

    // Iniciar quando o DOM estiver pronto
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initSyncSystem);
    } else {
        initSyncSystem();
    }

    // Exportar funções para debug (opcional)
    window.debugSync = {
        startService,
        stopService,
        smartUploadLoop,
        smartDownloadLoop,
        getDeviceId: () => DEVICE_ID,
        clearCache: () => {
            syncCache.clear();
            console.log('🧹 Cache de sincronização limpo');
        }
    };
})();
</script>

<script>
// SISTEMA DE RESTAURAÇÃO DE BACKUP
(function() {
    // Botão de restauração (se existir)
    const restoreBtn = document.getElementById('restoreBtn');
    if (restoreBtn) {
        restoreBtn.addEventListener('click', function() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = async function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                try {
                    const text = await file.text();
                    const backupData = JSON.parse(text);
                    
                    if (confirm(`Deseja restaurar backup com ${backupData.clients?.length || 0} clientes e ${backupData.projects?.length || 0} projetos?`)) {
                        await restoreBackup(backupData);
                    }
                } catch (error) {
                    alert('Erro ao ler arquivo de backup: ' + error.message);
                }
            };
            
            input.click();
        });
    }
    
    async function restoreBackup(backupData) {
        const DB_NAME = 'portallegacy';
        
        return new Promise((resolve, reject) => {
            const request = indexedDB.open(DB_NAME);
            
            request.onerror = () => reject('Erro ao abrir banco de dados');
            
            request.onsuccess = (event) => {
                const db = event.target.result;
                
                // Função para restaurar dados em uma store
                const restoreStore = (storeName, data) => {
                    return new Promise((resolveStore, rejectStore) => {
                        if (!data || !Array.isArray(data)) {
                            resolveStore(0);
                            return;
                        }
                        
                        const tx = db.transaction([storeName], 'readwrite');
                        const store = tx.objectStore(storeName);
                        
                        // Limpar store existente
                        const clearRequest = store.clear();
                        
                        clearRequest.onsuccess = () => {
                            let added = 0;
                            let errors = 0;
                            
                            // Inserir novos dados
                            data.forEach((item, index) => {
                                try {
                                    const addRequest = store.add(item);
                                    addRequest.onsuccess = () => added++;
                                    addRequest.onerror = () => errors++;
                                } catch (error) {
                                    errors++;
                                }
                            });
                            
                            tx.oncomplete = () => {
                                console.log(`✅ ${storeName}: ${added} restaurados, ${errors} erros`);
                                resolveStore(added);
                            };
                            
                            tx.onerror = () => rejectStore(`Erro na transação ${storeName}`);
                        };
                        
                        clearRequest.onerror = () => rejectStore(`Erro ao limpar ${storeName}`);
                    });
                };
                
                // Restaurar todas as stores
                const restorePromises = [];
                
                if (backupData.clients) {
                    restorePromises.push(restoreStore('clients', backupData.clients));
                }
                
                if (backupData.projects) {
                    restorePromises.push(restoreStore('projects', backupData.projects));
                }
                
                if (backupData.links) {
                    restorePromises.push(restoreStore('links', backupData.links));
                }
                
                if (backupData.orientations) {
                    restorePromises.push(restoreStore('orientations', backupData.orientations));
                }
                
                if (backupData.alerts) {
                    restorePromises.push(restoreStore('alerts', backupData.alerts));
                }
                
                // Executar todas as restaurações
                Promise.all(restorePromises)
                    .then(results => {
                        const total = results.reduce((sum, count) => sum + count, 0);
                        alert(`✅ Backup restaurado com sucesso!\n${total} registros importados.`);
                        
                        // Recarregar a página para atualizar os dados
                        setTimeout(() => location.reload(), 1000);
                        resolve(total);
                    })
                    .catch(error => {
                        alert('❌ Erro ao restaurar backup: ' + error);
                        reject(error);
                    });
            };
        });
    }
})();
</script>

<script>
// UTILITÁRIOS ADICIONAIS
(function() {
    // Verificar conexão com a internet
    function updateOnlineStatus() {
        const statusElement = document.getElementById('syncStatus');
        if (statusElement) {
            if (navigator.onLine) {
                statusElement.innerHTML = `
                    <i class="fas fa-wifi"></i>
                    <div>
                        <strong>Sincronização Ativa</strong>
                        <p>Conectado e sincronizando com a nuvem</p>
                    </div>
                `;
                statusElement.className = 'alert alert-success';
            } else {
                statusElement.innerHTML = `
                    <i class="fas fa-wifi-slash"></i>
                    <div>
                        <strong>Sincronização Offline</strong>
                        <p>Trabalhando localmente - dados serão sincronizados quando a conexão voltar</p>
                    </div>
                `;
                statusElement.className = 'alert alert-warning';
            }
        }
    }
    
    // Adicionar listeners de conexão
    window.addEventListener('online', updateOnlineStatus);
    window.addEventListener('offline', updateOnlineStatus);
    
    // Atualizar status inicial
    setTimeout(updateOnlineStatus, 1000);
    
    // Função para limpar cache do Supabase (para debug)
    window.clearSupabaseCache = function() {
        if (window.supabase && window.supabase.auth) {
            window.supabase.auth.signOut();
            localStorage.removeItem('lg_admin_session');
            sessionStorage.clear();
            alert('Cache do Supabase limpo!');
        }
    };
    
    // Adicionar atalhos de teclado
    document.addEventListener('keydown', function(e) {
        // Ctrl+S para salvar (quando em formulários)
        if (e.ctrlKey && e.key === 's') {
            e.preventDefault();
            const activeModal = document.querySelector('.modal.active');
            if (activeModal) {
                const saveButton = activeModal.querySelector('button[type="submit"]');
                if (saveButton) saveButton.click();
            }
        }
        
        // Esc para fechar modais
        if (e.key === 'Escape') {
            const activeModal = document.querySelector('.modal.active');
            if (activeModal) {
                const closeButton = activeModal.querySelector('.modal-close');
                if (closeButton) closeButton.click();
            }
        }
    });
    
    // Notificação de nova versão (opcional)
    const currentVersion = '2.0.0';
    const storedVersion = localStorage.getItem('lg_admin_version');
    
    if (!storedVersion || storedVersion !== currentVersion) {
        console.log(`🆕 Nova versão detectada: ${storedVersion} → ${currentVersion}`);
        localStorage.setItem('lg_admin_version', currentVersion);
        
        // Pode adicionar uma notificação visual aqui se desejar
        setTimeout(() => {
            if (confirm('Sistema atualizado! Deseja ver as novidades?')) {
                // Redirecionar para changelog ou mostrar modal
                alert(`Versão ${currentVersion}\n\n• Sistema de sincronização melhorado\n• Correções de bugs\n• Performance aprimorada`);
            }
        }, 3000);
    }
})();
</script>

</body>
</html>
