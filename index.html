<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Administrativo - LG Plataforma</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }

        :root {
            --primary: #00d9ff;
            --primary-dark: #0099cc;
            --secondary: #9d4edd;
            --secondary-dark: #7b2cbf;
            --dark: #0a0a0f;
            --dark-light: #12121a;
            --darker: #050509;
            --light: #f0f0f5;
            --gray: #8888a0;
            --success: #00cc88;
            --warning: #ffaa00;
            --danger: #ff3366;
            --glass: rgba(20, 20, 30, 0.7);
            --glass-light: rgba(30, 30, 45, 0.8);
            --border: rgba(100, 100, 150, 0.2);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            --neon-glow: 0 0 10px var(--primary), 0 0 20px var(--primary);
            --neon-glow-secondary: 0 0 10px var(--secondary), 0 0 20px var(--secondary);
        }

        body {
            background: linear-gradient(135deg, var(--darker), var(--dark));
            color: var(--light);
            min-height: 100vh;
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .glass-card {
            background: var(--glass);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            border: 1px solid var(--border);
            padding: 24px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .glass-card:hover {
            box-shadow: var(--shadow), var(--neon-glow);
            border-color: var(--primary);
        }

        .neon-text {
            color: var(--primary);
            text-shadow: 0 0 5px var(--primary);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 24px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            text-decoration: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--darker);
            box-shadow: 0 4px 15px rgba(0, 217, 255, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 217, 255, 0.5);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary), var(--secondary-dark));
            color: white;
            box-shadow: 0 4px 15px rgba(157, 78, 221, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #009966);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #cc2255);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 51, 102, 0.3);
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--light);
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            background: rgba(10, 10, 15, 0.6);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--light);
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 217, 255, 0.2);
        }

        .form-control::placeholder {
            color: var(--gray);
        }

        select.form-control {
            cursor: pointer;
        }

        textarea.form-control {
            resize: vertical;
            min-height: 100px;
        }

        .header {
            background: var(--glass);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            padding: 20px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: var(--shadow);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-menu {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 10px 20px;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--light);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-btn:hover, .nav-btn.active {
            background: rgba(0, 217, 255, 0.1);
            border-color: var(--primary);
            color: var(--primary);
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .section-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .section-title i {
            color: var(--primary);
        }

        .grid {
            display: grid;
            gap: 20px;
        }

        .grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }

        .table-responsive {
            overflow-x: auto;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .table th {
            background: rgba(0, 217, 255, 0.1);
            padding: 16px;
            text-align: left;
            font-weight: 600;
            color: var(--primary);
            border-bottom: 2px solid rgba(0, 217, 255, 0.3);
        }

        .table td {
            padding: 14px 16px;
            border-bottom: 1px solid rgba(100, 100, 150, 0.1);
        }

        .table tr:hover {
            background: rgba(0, 217, 255, 0.05);
        }

        .badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge-success {
            background: rgba(0, 204, 136, 0.2);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .badge-warning {
            background: rgba(255, 170, 0, 0.2);
            color: var(--warning);
            border: 1px solid var(--warning);
        }

        .badge-danger {
            background: rgba(255, 51, 102, 0.2);
            color: var(--danger);
            border: 1px solid var(--danger);
        }

        .badge-info {
            background: rgba(0, 217, 255, 0.2);
            color: var(--primary);
            border: 1px solid var(--primary);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--glass-light);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border);
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
        }

        .close-btn {
            background: transparent;
            border: none;
            color: var(--gray);
            font-size: 28px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            color: var(--danger);
            transform: rotate(90deg);
        }

        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--glass-light);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px 24px;
            box-shadow: var(--shadow);
            z-index: 3000;
            display: none;
            align-items: center;
            gap: 12px;
            min-width: 300px;
        }

        .toast.active {
            display: flex;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast-success {
            border-left: 4px solid var(--success);
        }

        .toast-danger {
            border-left: 4px solid var(--danger);
        }

        .toast-info {
            border-left: 4px solid var(--primary);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid rgba(0, 217, 255, 0.1);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .sync-log {
            background: rgba(10, 10, 15, 0.8);
            border-radius: 8px;
            padding: 16px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }

        .sync-log-entry {
            padding: 6px 0;
            border-bottom: 1px solid rgba(100, 100, 150, 0.1);
        }

        .sync-log-entry:last-child {
            border-bottom: none;
        }

        .sync-log-success {
            color: var(--success);
        }

        .sync-log-error {
            color: var(--danger);
        }

        .sync-log-info {
            color: var(--primary);
        }

        .stat-card {
            background: var(--glass);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            border: 1px solid var(--border);
            padding: 24px;
            text-align: center;
        }

        .stat-value {
            font-size: 48px;
            font-weight: 700;
            color: var(--primary);
            text-shadow: var(--neon-glow);
        }

        .stat-label {
            font-size: 16px;
            color: var(--gray);
            margin-top: 8px;
        }

        @media (max-width: 768px) {
            .nav-menu {
                flex-direction: column;
                width: 100%;
            }

            .nav-btn {
                width: 100%;
            }

            .grid-2 {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-rocket"></i> LG Admin
            </div>
            <div class="nav-menu">
                <button class="nav-btn active" onclick="showSection('dashboard')">
                    <i class="fas fa-chart-line"></i> Dashboard
                </button>
                <button class="nav-btn" onclick="showSection('clients')">
                    <i class="fas fa-users"></i> Clientes
                </button>
                <button class="nav-btn" onclick="showSection('projects')">
                    <i class="fas fa-project-diagram"></i> Projetos
                </button>
                <button class="nav-btn" onclick="showSection('deadlines')">
                    <i class="fas fa-calendar-check"></i> Prazos
                </button>
                <button class="nav-btn" onclick="showSection('alerts')">
                    <i class="fas fa-bell"></i> Alertas
                </button>
                <button class="nav-btn" onclick="showSection('links')">
                    <i class="fas fa-link"></i> Links
                </button>
                <button class="nav-btn" onclick="showSection('sync')">
                    <i class="fas fa-sync-alt"></i> Sincroniza√ß√£o
                </button>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- DASHBOARD SECTION -->
        <div id="dashboard" class="section active">
            <h1 class="section-title">
                <i class="fas fa-chart-line"></i>
                Dashboard
            </h1>

            <div class="grid grid-2">
                <div class="stat-card">
                    <div class="stat-value" id="totalClients">0</div>
                    <div class="stat-label">Total de Clientes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalProjects">0</div>
                    <div class="stat-label">Projetos Ativos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalDeadlines">0</div>
                    <div class="stat-label">Prazos Pendentes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalAlerts">0</div>
                    <div class="stat-label">Alertas Ativos</div>
                </div>
            </div>
        </div>

        <!-- CLIENTS SECTION -->
        <div id="clients" class="section">
            <h1 class="section-title">
                <i class="fas fa-users"></i>
                Gerenciamento de Clientes
            </h1>

            <div class="glass-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
                    <input type="text" id="searchClients" class="form-control" placeholder="üîç Buscar clientes..." style="max-width: 400px;" oninput="searchClients()">
                    <button class="btn btn-primary" onclick="openModal('clientModal')">
                        <i class="fas fa-plus"></i> Novo Cliente
                    </button>
                </div>

                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>CPF</th>
                                <th>Empresa</th>
                                <th>Email</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="clientsTableBody">
                            <tr><td colspan="5"><div class="loading"><div class="spinner"></div><p>Carregando...</p></div></td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- PROJECTS SECTION -->
        <div id="projects" class="section">
            <h1 class="section-title">
                <i class="fas fa-project-diagram"></i>
                Gerenciamento de Projetos
            </h1>

            <div class="glass-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
                    <input type="text" id="searchProjects" class="form-control" placeholder="üîç Buscar projetos..." style="max-width: 400px;" oninput="searchProjects()">
                    <button class="btn btn-primary" onclick="openProjectModal()">
                        <i class="fas fa-plus"></i> Novo Projeto
                    </button>
                </div>

                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>T√≠tulo</th>
                                <th>Cliente</th>
                                <th>Status</th>
                                <th>Progresso</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="projectsTableBody">
                            <tr><td colspan="5"><div class="loading"><div class="spinner"></div><p>Carregando...</p></div></td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- DEADLINES SECTION -->
        <div id="deadlines" class="section">
            <h1 class="section-title">
                <i class="fas fa-calendar-check"></i>
                Gerenciamento de Prazos
            </h1>

            <div class="glass-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
                    <input type="text" id="searchDeadlines" class="form-control" placeholder="üîç Buscar prazos..." style="max-width: 400px;" oninput="searchDeadlines()">
                    <button class="btn btn-primary" onclick="openDeadlineModal()">
                        <i class="fas fa-plus"></i> Novo Prazo
                    </button>
                </div>

                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>T√≠tulo</th>
                                <th>Cliente</th>
                                <th>Data Limite</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="deadlinesTableBody">
                            <tr><td colspan="5"><div class="loading"><div class="spinner"></div><p>Carregando...</p></div></td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ALERTS SECTION -->
        <div id="alerts" class="section">
            <h1 class="section-title">
                <i class="fas fa-bell"></i>
                Gerenciamento de Alertas
            </h1>

            <div class="glass-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
                    <input type="text" id="searchAlerts" class="form-control" placeholder="üîç Buscar alertas..." style="max-width: 400px;" oninput="searchAlerts()">
                    <button class="btn btn-primary" onclick="openAlertModal()">
                        <i class="fas fa-plus"></i> Novo Alerta
                    </button>
                </div>

                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>T√≠tulo</th>
                                <th>Cliente</th>
                                <th>Tipo</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="alertsTableBody">
                            <tr><td colspan="5"><div class="loading"><div class="spinner"></div><p>Carregando...</p></div></td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- LINKS SECTION -->
        <div id="links" class="section">
            <h1 class="section-title">
                <i class="fas fa-link"></i>
                Gerenciamento de Links
            </h1>

            <div class="glass-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
                    <input type="text" id="searchLinks" class="form-control" placeholder="üîç Buscar links..." style="max-width: 400px;" oninput="searchLinks()">
                    <button class="btn btn-primary" onclick="openLinkModal()">
                        <i class="fas fa-plus"></i> Novo Link
                    </button>
                </div>

                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>T√≠tulo</th>
                                <th>Cliente</th>
                                <th>URL</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="linksTableBody">
                            <tr><td colspan="5"><div class="loading"><div class="spinner"></div><p>Carregando...</p></div></td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- SYNC SECTION -->
        <div id="sync" class="section">
            <h1 class="section-title">
                <i class="fas fa-sync-alt"></i>
                Sincroniza√ß√£o com Supabase
            </h1>

            <div class="glass-card">
                <h3 style="margin-bottom: 20px;">Configura√ß√£o do Supabase</h3>
                <div class="form-group">
                    <label class="form-label">Supabase URL</label>
                    <input type="text" id="supabaseUrl" class="form-control" placeholder="https://seu-projeto.supabase.co">
                </div>
                <div class="form-group">
                    <label class="form-label">Supabase Anon Key</label>
                    <input type="text" id="supabaseKey" class="form-control" placeholder="sua-chave-anon-key">
                </div>
                <button class="btn btn-primary" onclick="connectSupabase()">
                    <i class="fas fa-plug"></i> Conectar ao Supabase
                </button>
            </div>

            <div class="glass-card">
                <h3 style="margin-bottom: 20px;">Opera√ß√µes de Sincroniza√ß√£o</h3>
                <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                    <button class="btn btn-success" onclick="syncAllToSupabase()">
                        <i class="fas fa-cloud-upload-alt"></i> PUSH - Enviar tudo para Supabase
                    </button>
                    <button class="btn btn-secondary" onclick="syncAllFromSupabase()">
                        <i class="fas fa-cloud-download-alt"></i> PULL - Baixar tudo do Supabase
                    </button>
                </div>
            </div>

            <div class="glass-card">
                <h3 style="margin-bottom: 20px;">Log de Sincroniza√ß√£o</h3>
                <div class="sync-log" id="syncLog">
                    <div class="sync-log-entry sync-log-info">Aguardando opera√ß√µes...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- CLIENT MODAL -->
    <div id="clientModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Cadastro de Cliente</h2>
                <button class="close-btn" onclick="closeModal('clientModal')">&times;</button>
            </div>
            <form id="clientForm" onsubmit="saveClient(event)">
                <input type="hidden" id="clientId">
                <div class="form-group">
                    <label class="form-label">Nome Completo *</label>
                    <input type="text" id="clientName" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">CPF *</label>
                    <input type="text" id="clientCpf" class="form-control" required maxlength="14">
                </div>
                <div class="form-group">
                    <label class="form-label">Empresa</label>
                    <input type="text" id="clientCompany" class="form-control">
                </div>
                <div class="form-group">
                    <label class="form-label">Email</label>
                    <input type="email" id="clientEmail" class="form-control">
                </div>
                <div class="form-group">
                    <label class="form-label">Telefone</label>
                    <input type="tel" id="clientPhone" class="form-control">
                </div>
                <div style="display: flex; gap: 15px; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('clientModal')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar Cliente</button>
                </div>
            </form>
        </div>
    </div>

    <!-- PROJECT MODAL -->
    <div id="projectModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Cadastro de Projeto</h2>
                <button class="close-btn" onclick="closeModal('projectModal')">&times;</button>
            </div>
            <form id="projectForm" onsubmit="saveProject(event)">
                <input type="hidden" id="projectId">
                <div class="form-group">
                    <label class="form-label">Cliente *</label>
                    <select id="projectClientId" class="form-control" required>
                        <option value="">Selecione um cliente</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">T√≠tulo do Projeto *</label>
                    <input type="text" id="projectTitle" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Descri√ß√£o</label>
                    <textarea id="projectDescription" class="form-control"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Status</label>
                    <select id="projectStatus" class="form-control">
                        <option value="planning">Planejamento</option>
                        <option value="in_progress">Em Progresso</option>
                        <option value="completed">Conclu√≠do</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Progresso (%)</label>
                    <input type="number" id="projectProgress" class="form-control" min="0" max="100" value="0">
                </div>
                <div style="display: flex; gap: 15px; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('projectModal')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar Projeto</button>
                </div>
            </form>
        </div>
    </div>

    <!-- DEADLINE MODAL -->
    <div id="deadlineModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Cadastro de Prazo</h2>
                <button class="close-btn" onclick="closeModal('deadlineModal')">&times;</button>
            </div>
            <form id="deadlineForm" onsubmit="saveDeadline(event)">
                <input type="hidden" id="deadlineId">
                <div class="form-group">
                    <label class="form-label">Cliente *</label>
                    <select id="deadlineClientId" class="form-control" required>
                        <option value="">Selecione um cliente</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">T√≠tulo *</label>
                    <input type="text" id="deadlineTitle" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Descri√ß√£o</label>
                    <textarea id="deadlineDescription" class="form-control"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Data Limite *</label>
                    <input type="date" id="deadlineDate" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Status</label>
                    <select id="deadlineStatus" class="form-control">
                        <option value="pendente">Pendente</option>
                        <option value="em_andamento">Em Andamento</option>
                        <option value="concluido">Conclu√≠do</option>
                    </select>
                </div>
                <div style="display: flex; gap: 15px; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('deadlineModal')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar Prazo</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ALERT MODAL -->
    <div id="alertModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Cadastro de Alerta</h2>
                <button class="close-btn" onclick="closeModal('alertModal')">&times;</button>
            </div>
            <form id="alertForm" onsubmit="saveAlert(event)">
                <input type="hidden" id="alertId">
                <div class="form-group">
                    <label class="form-label">Cliente *</label>
                    <select id="alertClientId" class="form-control" required>
                        <option value="">Selecione um cliente</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">T√≠tulo *</label>
                    <input type="text" id="alertTitle" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Mensagem</label>
                    <textarea id="alertMessage" class="form-control"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Tipo</label>
                    <select id="alertType" class="form-control">
                        <option value="info">Informa√ß√£o</option>
                        <option value="warning">Aviso</option>
                        <option value="error">Erro</option>
                        <option value="success">Sucesso</option>
                    </select>
                </div>
                <div style="display: flex; gap: 15px; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('alertModal')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar Alerta</button>
                </div>
            </form>
        </div>
    </div>

    <!-- LINK MODAL -->
    <div id="linkModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Cadastro de Link</h2>
                <button class="close-btn" onclick="closeModal('linkModal')">&times;</button>
            </div>
            <form id="linkForm" onsubmit="saveLink(event)">
                <input type="hidden" id="linkId">
                <div class="form-group">
                    <label class="form-label">Cliente *</label>
                    <select id="linkClientId" class="form-control" required>
                        <option value="">Selecione um cliente</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">T√≠tulo *</label>
                    <input type="text" id="linkTitle" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">URL *</label>
                    <input type="url" id="linkUrl" class="form-control" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Descri√ß√£o</label>
                    <textarea id="linkDescription" class="form-control"></textarea>
                </div>
                <div style="display: flex; gap: 15px; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('linkModal')">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Salvar Link</button>
                </div>
            </form>
        </div>
    </div>

    <!-- TOAST NOTIFICATION -->
    <div id="toast" class="toast"></div>

    <script>
// ==================== INDEXEDDB CONFIGURATION ====================
const DB_NAME = 'LGAdminDB';
const DB_VERSION = 1;
let db;

const STORES = {
    clients: 'clients',
    projects: 'projects',
    deadlines: 'deadlines',
    alerts: 'alerts',
    links: 'links'
};

const SUPABASE_TABLES = {
    clients: 'clientes',
    projects: 'projetos',
    deadlines: 'prazos',
    alerts: 'alertas',
    links: 'links'
};

let supabaseClient = null;

function initDB() {
    return new Promise((resolve, reject) => {
        const request = indexedDB.open(DB_NAME, DB_VERSION);

        request.onerror = () => reject(request.error);
        request.onsuccess = () => {
            db = request.result;
            resolve(db);
        };

        request.onupgradeneeded = (event) => {
            db = event.target.result;

            if (!db.objectStoreNames.contains(STORES.clients)) {
                const clientStore = db.createObjectStore(STORES.clients, { keyPath: 'id', autoIncrement: true });
                clientStore.createIndex('cpf', 'cpf', { unique: true });
                clientStore.createIndex('email', 'email', { unique: false });
            }

            if (!db.objectStoreNames.contains(STORES.projects)) {
                const projectStore = db.createObjectStore(STORES.projects, { keyPath: 'id', autoIncrement: true });
                projectStore.createIndex('cliente_id', 'cliente_id', { unique: false });
            }

            if (!db.objectStoreNames.contains(STORES.deadlines)) {
                const deadlineStore = db.createObjectStore(STORES.deadlines, { keyPath: 'id', autoIncrement: true });
                deadlineStore.createIndex('cliente_id', 'cliente_id', { unique: false });
            }

            if (!db.objectStoreNames.contains(STORES.alerts)) {
                const alertStore = db.createObjectStore(STORES.alerts, { keyPath: 'id', autoIncrement: true });
                alertStore.createIndex('cliente_id', 'cliente_id', { unique: false });
            }

            if (!db.objectStoreNames.contains(STORES.links)) {
                const linkStore = db.createObjectStore(STORES.links, { keyPath: 'id', autoIncrement: true });
                linkStore.createIndex('cliente_id', 'cliente_id', { unique: false });
            }
        };
    });
}

function addRecord(storeName, data) {
    return new Promise((resolve, reject) => {
        const transaction = db.transaction([storeName], 'readwrite');
        const store = transaction.objectStore(storeName);
        const request = store.add(data);

        request.onsuccess = () => resolve(request.result);
        request.onerror = () => reject(request.error);
    });
}

function updateRecord(storeName, data) {
    return new Promise((resolve, reject) => {
        const transaction = db.transaction([storeName], 'readwrite');
        const store = transaction.objectStore(storeName);
        const request = store.put(data);

        request.onsuccess = () => resolve(request.result);
        request.onerror = () => reject(request.error);
    });
}

function deleteRecord(storeName, id) {
    return new Promise((resolve, reject) => {
        const transaction = db.transaction([storeName], 'readwrite');
        const store = transaction.objectStore(storeName);
        const request = store.delete(id);

        request.onsuccess = () => resolve();
        request.onerror = () => reject(request.error);
    });
}

function getRecord(storeName, id) {
    return new Promise((resolve, reject) => {
        const transaction = db.transaction([storeName], 'readonly');
        const store = transaction.objectStore(storeName);
        const request = store.get(id);

        request.onsuccess = () => resolve(request.result);
        request.onerror = () => reject(request.error);
    });
}

function getAllRecords(storeName) {
    return new Promise((resolve, reject) => {
        const transaction = db.transaction([storeName], 'readonly');
        const store = transaction.objectStore(storeName);
        const request = store.getAll();

        request.onsuccess = () => resolve(request.result);
        request.onerror = () => reject(request.error);
    });
}

// ==================== UI FUNCTIONS ====================
function showSection(sectionId) {
    document.querySelectorAll('.section').forEach(section => {
        section.classList.remove('active');
    });
    document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.classList.remove('active');
    });

    document.getElementById(sectionId).classList.add('active');
    event.target.classList.add('active');

    if (sectionId === 'clients') loadClients();
    if (sectionId === 'projects') loadProjects();
    if (sectionId === 'deadlines') loadDeadlines();
    if (sectionId === 'alerts') loadAlerts();
    if (sectionId === 'links') loadLinks();
}

function openModal(modalId) {
    const modal = document.getElementById(modalId);
    modal.classList.add('active');

    if (modalId === 'clientModal') {
        document.getElementById('clientForm').reset();
        document.getElementById('clientId').value = '';
    }
}

function closeModal(modalId) {
    document.getElementById(modalId).classList.remove('active');
}

function showToast(message, type = 'success') {
    const toast = document.getElementById('toast');
    toast.textContent = message;
    toast.className = `toast toast-${type} active`;

    setTimeout(() => {
        toast.classList.remove('active');
    }, 3000);
}

function formatCPF(cpf) {
    return cpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
}

function formatDate(dateStr) {
    const date = new Date(dateStr);
    return date.toLocaleDateString('pt-BR');
}

// ==================== DASHBOARD ====================
async function updateDashboard() {
    try {
        const clients = await getAllRecords(STORES.clients);
        const projects = await getAllRecords(STORES.projects);
        const deadlines = await getAllRecords(STORES.deadlines);
        const alerts = await getAllRecords(STORES.alerts);

        document.getElementById('totalClients').textContent = clients.length;
        document.getElementById('totalProjects').textContent = projects.filter(p => p.status !== 'completed').length;
        document.getElementById('totalDeadlines').textContent = deadlines.filter(d => d.status === 'pendente').length;
        document.getElementById('totalAlerts').textContent = alerts.filter(a => a.status === 'active').length;
    } catch (error) {
        console.error('Error updating dashboard:', error);
    }
}

// ==================== CLIENTS ====================
async function loadClients() {
    const tbody = document.getElementById('clientsTableBody');
    tbody.innerHTML = '<tr><td colspan="5"><div class="loading"><div class="spinner"></div><p>Carregando...</p></div></td></tr>';

    try {
        const clients = await getAllRecords(STORES.clients);

        if (clients.length === 0) {
            tbody.innerHTML = '<tr><td colspan="5"><div class="empty-state"><i class="fas fa-users"></i><p>Nenhum cliente cadastrado</p></div></td></tr>';
            return;
        }

        tbody.innerHTML = clients.map(client => `
            <tr>
                <td>${client.nome}</td>
                <td>${formatCPF(client.cpf)}</td>
                <td>${client.empresa || '-'}</td>
                <td>${client.email || '-'}</td>
                <td>
                    <button class="btn btn-sm btn-primary" onclick="editClient(${client.id})">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-sm btn-danger" onclick="confirmDelete('client', ${client.id}, '${client.nome}')">
                        <i class="fas fa-trash"></i>
                    </button>
                </td>
            </tr>
        `).join('');
    } catch (error) {
        console.error('Error loading clients:', error);
        showToast('Erro ao carregar clientes', 'danger');
    }
}

async function saveClient(event) {
    event.preventDefault();

    const client = {
        nome: document.getElementById('clientName').value,
        cpf: document.getElementById('clientCpf').value.replace(/\D/g, ''),
        empresa: document.getElementById('clientCompany').value,
        email: document.getElementById('clientEmail').value,
        telefone: document.getElementById('clientPhone').value,
        status: 'active',
        created_at: new Date().toISOString()
    };

    const clientId = document.getElementById('clientId').value;

    try {
        if (clientId) {
            client.id = parseInt(clientId);
            await updateRecord(STORES.clients, client);
            showToast('Cliente atualizado com sucesso!');
        } else {
            await addRecord(STORES.clients, client);
            showToast('Cliente cadastrado com sucesso!');
        }

        closeModal('clientModal');
        loadClients();
        updateDashboard();
    } catch (error) {
        console.error('Error saving client:', error);
        showToast('Erro ao salvar cliente', 'danger');
    }
}

async function editClient(id) {
    try {
        const client = await getRecord(STORES.clients, id);
        
        document.getElementById('clientId').value = client.id;
        document.getElementById('clientName').value = client.nome;
        document.getElementById('clientCpf').value = client.cpf;
        document.getElementById('clientCompany').value = client.empresa || '';
        document.getElementById('clientEmail').value = client.email || '';
        document.getElementById('clientPhone').value = client.telefone || '';

        openModal('clientModal');
    } catch (error) {
        console.error('Error loading client:', error);
        showToast('Erro ao carregar cliente', 'danger');
    }
}

function searchClients() {
    const searchTerm = document.getElementById('searchClients').value.toLowerCase();
    const rows = document.querySelectorAll('#clientsTableBody tr');

    rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(searchTerm) ? '' : 'none';
    });
}

// ==================== PROJECTS ====================
async function openProjectModal() {
    await loadClientsToSelect();
    document.getElementById('projectForm').reset();
    document.getElementById('projectId').value = '';
    openModal('projectModal');
}

async function loadClientsToSelect() {
    try {
        const clients = await getAllRecords(STORES.clients);
        const selects = [
            document.getElementById('projectClientId'),
            document.getElementById('deadlineClientId'),
            document.getElementById('alertClientId'),
            document.getElementById('linkClientId')
        ];

        selects.forEach(select => {
            if (select) {
                select.innerHTML = '<option value="">Selecione um cliente</option>' +
                    clients.map(c => `<option value="${c.id}" data-cpf="${c.cpf}">${c.nome}</option>`).join('');
            }
        });
    } catch (error) {
        console.error('Error loading clients to select:', error);
    }
}

async function loadProjects() {
    const tbody = document.getElementById('projectsTableBody');
    tbody.innerHTML = '<tr><td colspan="5"><div class="loading"><div class="spinner"></div><p>Carregando...</p></div></td></tr>';

    try {
        const projects = await getAllRecords(STORES.projects);
        const clients = await getAllRecords(STORES.clients);
        const clientMap = Object.fromEntries(clients.map(c => [c.id, c.nome]));

        if (projects.length === 0) {
            tbody.innerHTML = '<tr><td colspan="5"><div class="empty-state"><i class="fas fa-project-diagram"></i><p>Nenhum projeto cadastrado</p></div></td></tr>';
            return;
        }

        tbody.innerHTML = projects.map(project => {
            const statusBadge = {
                'planning': 'badge-info',
                'in_progress': 'badge-warning',
                'completed': 'badge-success'
            }[project.status] || 'badge-info';

            return `
                <tr>
                    <td>${project.titulo}</td>
                    <td>${clientMap[project.cliente_id] || 'N/A'}</td>
                    <td><span class="badge ${statusBadge}">${project.status}</span></td>
                    <td>${project.progresso || 0}%</td>
                    <td>
                        <button class="btn btn-sm btn-secondary" onclick="editProject(${project.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="confirmDelete('project', ${project.id}, '${project.titulo}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `;
        }).join('');
    } catch (error) {
        console.error('Error loading projects:', error);
        showToast('Erro ao carregar projetos', 'danger');
    }
}

async function saveProject(event) {
    event.preventDefault();

    const clientId = parseInt(document.getElementById('projectClientId').value);
    const clientSelect = document.getElementById('projectClientId');
    const clientCpf = clientSelect.options[clientSelect.selectedIndex].getAttribute('data-cpf');

    const project = {
        cliente_id: clientId,
        cliente_cpf: clientCpf,
        titulo: document.getElementById('projectTitle').value,
        descricao: document.getElementById('projectDescription').value,
        status: document.getElementById('projectStatus').value,
        progresso: parseInt(document.getElementById('projectProgress').value),
        created_at: new Date().toISOString()
    };

    const projectId = document.getElementById('projectId').value;

    try {
        if (projectId) {
            project.id = parseInt(projectId);
            await updateRecord(STORES.projects, project);
            showToast('Projeto atualizado com sucesso!');
        } else {
            await addRecord(STORES.projects, project);
            showToast('Projeto cadastrado com sucesso!');
        }

        closeModal('projectModal');
        loadProjects();
        updateDashboard();
    } catch (error) {
        console.error('Error saving project:', error);
        showToast('Erro ao salvar projeto', 'danger');
    }
}

async function editProject(id) {
    try {
        await loadClientsToSelect();
        const project = await getRecord(STORES.projects, id);
        
        document.getElementById('projectId').value = project.id;
        document.getElementById('projectClientId').value = project.cliente_id;
        document.getElementById('projectTitle').value = project.titulo;
        document.getElementById('projectDescription').value = project.descricao || '';
        document.getElementById('projectStatus').value = project.status;
        document.getElementById('projectProgress').value = project.progresso || 0;

        openModal('projectModal');
    } catch (error) {
        console.error('Error loading project:', error);
        showToast('Erro ao carregar projeto', 'danger');
    }
}

function searchProjects() {
    const searchTerm = document.getElementById('searchProjects').value.toLowerCase();
    const rows = document.querySelectorAll('#projectsTableBody tr');

    rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(searchTerm) ? '' : 'none';
    });
}

// ==================== DEADLINES ====================
async function openDeadlineModal() {
    await loadClientsToSelect();
    document.getElementById('deadlineForm').reset();
    document.getElementById('deadlineId').value = '';
    openModal('deadlineModal');
}

async function loadDeadlines() {
    const tbody = document.getElementById('deadlinesTableBody');
    tbody.innerHTML = '<tr><td colspan="5"><div class="loading"><div class="spinner"></div><p>Carregando...</p></div></td></tr>';

    try {
        const deadlines = await getAllRecords(STORES.deadlines);
        const clients = await getAllRecords(STORES.clients);
        const clientMap = Object.fromEntries(clients.map(c => [c.id, c.nome]));

        if (deadlines.length === 0) {
            tbody.innerHTML = '<tr><td colspan="5"><div class="empty-state"><i class="fas fa-calendar-check"></i><p>Nenhum prazo cadastrado</p></div></td></tr>';
            return;
        }

        tbody.innerHTML = deadlines.map(deadline => {
            const statusBadge = {
                'pendente': 'badge-warning',
                'em_andamento': 'badge-info',
                'concluido': 'badge-success'
            }[deadline.status] || 'badge-warning';

            return `
                <tr>
                    <td>${deadline.titulo}</td>
                    <td>${clientMap[deadline.cliente_id] || 'N/A'}</td>
                    <td>${formatDate(deadline.data_limite)}</td>
                    <td><span class="badge ${statusBadge}">${deadline.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-secondary" onclick="editDeadline(${deadline.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="confirmDelete('deadline', ${deadline.id}, '${deadline.titulo}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `;
        }).join('');
    } catch (error) {
        console.error('Error loading deadlines:', error);
        showToast('Erro ao carregar prazos', 'danger');
    }
}

async function saveDeadline(event) {
    event.preventDefault();

    const clientId = parseInt(document.getElementById('deadlineClientId').value);
    const clientSelect = document.getElementById('deadlineClientId');
    const clientCpf = clientSelect.options[clientSelect.selectedIndex].getAttribute('data-cpf');

    const deadline = {
        cliente_id: clientId,
        cliente_cpf: clientCpf,
        titulo: document.getElementById('deadlineTitle').value,
        descricao: document.getElementById('deadlineDescription').value,
        data_limite: document.getElementById('deadlineDate').value,
        status: document.getElementById('deadlineStatus').value,
        created_at: new Date().toISOString()
    };

    const deadlineId = document.getElementById('deadlineId').value;

    try {
        if (deadlineId) {
            deadline.id = parseInt(deadlineId);
            await updateRecord(STORES.deadlines, deadline);
            showToast('Prazo atualizado com sucesso!');
        } else {
            await addRecord(STORES.deadlines, deadline);
            showToast('Prazo cadastrado com sucesso!');
        }

        closeModal('deadlineModal');
        loadDeadlines();
        updateDashboard();
    } catch (error) {
        console.error('Error saving deadline:', error);
        showToast('Erro ao salvar prazo', 'danger');
    }
}

async function editDeadline(id) {
    try {
        await loadClientsToSelect();
        const deadline = await getRecord(STORES.deadlines, id);
        
        document.getElementById('deadlineId').value = deadline.id;
        document.getElementById('deadlineClientId').value = deadline.cliente_id;
        document.getElementById('deadlineTitle').value = deadline.titulo;
        document.getElementById('deadlineDescription').value = deadline.descricao || '';
        document.getElementById('deadlineDate').value = deadline.data_limite;
        document.getElementById('deadlineStatus').value = deadline.status;

        openModal('deadlineModal');
    } catch (error) {
        console.error('Error loading deadline:', error);
        showToast('Erro ao carregar prazo', 'danger');
    }
}

function searchDeadlines() {
    const searchTerm = document.getElementById('searchDeadlines').value.toLowerCase();
    const rows = document.querySelectorAll('#deadlinesTableBody tr');

    rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(searchTerm) ? '' : 'none';
    });
}

// ==================== ALERTS ====================
async function openAlertModal() {
    await loadClientsToSelect();
    document.getElementById('alertForm').reset();
    document.getElementById('alertId').value = '';
    openModal('alertModal');
}

async function loadAlerts() {
    const tbody = document.getElementById('alertsTableBody');
    tbody.innerHTML = '<tr><td colspan="5"><div class="loading"><div class="spinner"></div><p>Carregando...</p></div></td></tr>';

    try {
        const alerts = await getAllRecords(STORES.alerts);
        const clients = await getAllRecords(STORES.clients);
        const clientMap = Object.fromEntries(clients.map(c => [c.id, c.nome]));

        if (alerts.length === 0) {
            tbody.innerHTML = '<tr><td colspan="5"><div class="empty-state"><i class="fas fa-bell"></i><p>Nenhum alerta cadastrado</p></div></td></tr>';
            return;
        }

        tbody.innerHTML = alerts.map(alert => {
            const typeBadge = {
                'info': 'badge-info',
                'warning': 'badge-warning',
                'error': 'badge-danger',
                'success': 'badge-success'
            }[alert.tipo] || 'badge-info';

            const statusBadge = alert.status === 'active' ? 'badge-success' : 'badge-danger';

            return `
                <tr>
                    <td>${alert.titulo}</td>
                    <td>${clientMap[alert.cliente_id] || 'N/A'}</td>
                    <td><span class="badge ${typeBadge}">${alert.tipo}</span></td>
                    <td><span class="badge ${statusBadge}">${alert.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-secondary" onclick="editAlert(${alert.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="confirmDelete('alert', ${alert.id}, '${alert.titulo}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `;
        }).join('');
    } catch (error) {
        console.error('Error loading alerts:', error);
        showToast('Erro ao carregar alertas', 'danger');
    }
}

async function saveAlert(event) {
    event.preventDefault();

    const clientId = parseInt(document.getElementById('alertClientId').value);
    const clientSelect = document.getElementById('alertClientId');
    const clientCpf = clientSelect.options[clientSelect.selectedIndex].getAttribute('data-cpf');

    const alert = {
        cliente_id: clientId,
        cliente_cpf: clientCpf,
        titulo: document.getElementById('alertTitle').value,
        mensagem: document.getElementById('alertMessage').value,
        tipo: document.getElementById('alertType').value,
        status: 'active',
        created_at: new Date().toISOString()
    };

    const alertId = document.getElementById('alertId').value;

    try {
        if (alertId) {
            alert.id = parseInt(alertId);
            await updateRecord(STORES.alerts, alert);
            showToast('Alerta atualizado com sucesso!');
        } else {
            await addRecord(STORES.alerts, alert);
            showToast('Alerta cadastrado com sucesso!');
        }

        closeModal('alertModal');
        loadAlerts();
        updateDashboard();
    } catch (error) {
        console.error('Error saving alert:', error);
        showToast('Erro ao salvar alerta', 'danger');
    }
}

async function editAlert(id) {
    try {
        await loadClientsToSelect();
        const alert = await getRecord(STORES.alerts, id);
        
        document.getElementById('alertId').value = alert.id;
        document.getElementById('alertClientId').value = alert.cliente_id;
        document.getElementById('alertTitle').value = alert.titulo;
        document.getElementById('alertMessage').value = alert.mensagem || '';
        document.getElementById('alertType').value = alert.tipo;

        openModal('alertModal');
    } catch (error) {
        console.error('Error loading alert:', error);
        showToast('Erro ao carregar alerta', 'danger');
    }
}

function searchAlerts() {
    const searchTerm = document.getElementById('searchAlerts').value.toLowerCase();
    const rows = document.querySelectorAll('#alertsTableBody tr');

    rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(searchTerm) ? '' : 'none';
    });
}

// ==================== LINKS ====================
async function openLinkModal() {
    await loadClientsToSelect();
    document.getElementById('linkForm').reset();
    document.getElementById('linkId').value = '';
    openModal('linkModal');
}

async function loadLinks() {
    const tbody = document.getElementById('linksTableBody');
    tbody.innerHTML = '<tr><td colspan="5"><div class="loading"><div class="spinner"></div><p>Carregando...</p></div></td></tr>';

    try {
        const links = await getAllRecords(STORES.links);
        const clients = await getAllRecords(STORES.clients);
        const clientMap = Object.fromEntries(clients.map(c => [c.id, c.nome]));

        if (links.length === 0) {
            tbody.innerHTML = '<tr><td colspan="5"><div class="empty-state"><i class="fas fa-link"></i><p>Nenhum link cadastrado</p></div></td></tr>';
            return;
        }

        tbody.innerHTML = links.map(link => {
            const statusBadge = link.status === 'active' ? 'badge-success' : 'badge-danger';

            return `
                <tr>
                    <td>${link.titulo}</td>
                    <td>${clientMap[link.cliente_id] || 'N/A'}</td>
                    <td><a href="${link.url}" target="_blank" style="color: var(--primary);">${link.url}</a></td>
                    <td><span class="badge ${statusBadge}">${link.status}</span></td>
                    <td>
                        <button class="btn btn-sm btn-secondary" onclick="editLink(${link.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="confirmDelete('link', ${link.id}, '${link.titulo}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `;
        }).join('');
    } catch (error) {
        console.error('Error loading links:', error);
        showToast('Erro ao carregar links', 'danger');
    }
}

async function saveLink(event) {
    event.preventDefault();

    const clientId = parseInt(document.getElementById('linkClientId').value);
    const clientSelect = document.getElementById('linkClientId');
    const clientCpf = clientSelect.options[clientSelect.selectedIndex].getAttribute('data-cpf');

    const link = {
        cliente_id: clientId,
        cliente_cpf: clientCpf,
        titulo: document.getElementById('linkTitle').value,
        url: document.getElementById('linkUrl').value,
        descricao: document.getElementById('linkDescription').value,
        status: 'active',
        created_at: new Date().toISOString()
    };

    const linkId = document.getElementById('linkId').value;

    try {
        if (linkId) {
            link.id = parseInt(linkId);
            await updateRecord(STORES.links, link);
            showToast('Link atualizado com sucesso!');
        } else {
            await addRecord(STORES.links, link);
            showToast('Link cadastrado com sucesso!');
        }

        closeModal('linkModal');
        loadLinks();
        updateDashboard();
    } catch (error) {
        console.error('Error saving link:', error);
        showToast('Erro ao salvar link', 'danger');
    }
}

async function editLink(id) {
    try {
        await loadClientsToSelect();
        const link = await getRecord(STORES.links, id);
        
        document.getElementById('linkId').value = link.id;
        document.getElementById('linkClientId').value = link.cliente_id;
        document.getElementById('linkTitle').value = link.titulo;
        document.getElementById('linkUrl').value = link.url;
        document.getElementById('linkDescription').value = link.descricao || '';

        openModal('linkModal');
    } catch (error) {
        console.error('Error loading link:', error);
        showToast('Erro ao carregar link', 'danger');
    }
}

function searchLinks() {
    const searchTerm = document.getElementById('searchLinks').value.toLowerCase();
    const rows = document.querySelectorAll('#linksTableBody tr');

    rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(searchTerm) ? '' : 'none';
    });
}

// ==================== DELETE ====================
async function confirmDelete(type, id, name) {
    if (!confirm(`Tem certeza que deseja excluir: ${name}?`)) return;

    const storeMap = {
        'client': STORES.clients,
        'project': STORES.projects,
        'deadline': STORES.deadlines,
        'alert': STORES.alerts,
        'link': STORES.links
    };

    try {
        await deleteRecord(storeMap[type], id);
        showToast(`${name} exclu√≠do com sucesso!`);
        
        if (type === 'client') loadClients();
        if (type === 'project') loadProjects();
        if (type === 'deadline') loadDeadlines();
        if (type === 'alert') loadAlerts();
        if (type === 'link') loadLinks();
        
        updateDashboard();
    } catch (error) {
        console.error('Error deleting record:', error);
        showToast('Erro ao excluir registro', 'danger');
    }
}

// ==================== SUPABASE SYNC ====================
function connectSupabase() {
    const url = document.getElementById('supabaseUrl').value;
    const key = document.getElementById('supabaseKey').value;

    if (!url || !key) {
        showToast('Por favor, preencha URL e Key do Supabase', 'danger');
        return;
    }

    try {
        supabaseClient = supabase.createClient(url, key);
        showToast('Conectado ao Supabase com sucesso!', 'success');
        addSyncLog('‚úÖ Conectado ao Supabase!', 'success');
    } catch (error) {
        console.error('Connection error:', error);
        showToast('Erro ao conectar ao Supabase', 'danger');
        addSyncLog('‚ùå Erro de conex√£o: ' + error.message, 'error');
    }
}

function addSyncLog(message, type = 'info') {
    const log = document.getElementById('syncLog');
    const entry = document.createElement('div');
    entry.className = `sync-log-entry sync-log-${type}`;
    entry.textContent = `[${new Date().toLocaleTimeString('pt-BR')}] ${message}`;
    log.appendChild(entry);
    log.scrollTop = log.scrollHeight;
}

async function syncAllToSupabase() {
    if (!supabaseClient) {
        showToast('Conecte-se ao Supabase primeiro!', 'danger');
        return;
    }

    addSyncLog('üöÄ Iniciando PUSH de dados para o Supabase...', 'info');
    showToast('üì§ Enviando dados para o Supabase...', 'info');

    try {
        await syncClientsToSupabase();
        await syncProjectsToSupabase();
        await syncDeadlinesToSupabase();
        await syncAlertsToSupabase();
        await syncLinksToSupabase();

        addSyncLog('‚úÖ PUSH completo! Todos os dados foram enviados com sucesso!', 'success');
        showToast('‚úÖ Sincroniza√ß√£o PUSH conclu√≠da!', 'success');
    } catch (error) {
        console.error('Sync error:', error);
        addSyncLog('‚ùå Erro no PUSH: ' + error.message, 'error');
        showToast('‚ùå Erro na sincroniza√ß√£o PUSH', 'danger');
    }
}

async function syncClientsToSupabase() {
    addSyncLog('üì§ Enviando clientes para o Supabase...', 'info');
    const clients = await getAllRecords(STORES.clients);
    let successCount = 0;

    for (const client of clients) {
        try {
            const senhaDefault = client.senha || `${client.cpf.substring(0, 6)}@Lg`;
            
            const { error } = await supabaseClient
                .from(SUPABASE_TABLES.clients)
                .upsert({
                    id: client.id,
                    local_id: client.id,
                    nome: client.nome,
                    cpf: client.cpf,
                    email: client.email,
                    senha: senhaDefault,
                    status: client.status || 'active',
                    criado_em: client.created_at
                }, { onConflict: 'id' });

            if (error) throw error;
            successCount++;
            addSyncLog(`‚úÖ Cliente "${client.nome}" sincronizado`, 'success');
        } catch (error) {
            addSyncLog(`‚ùå Erro ao sincronizar cliente ${client.nome}: ${error.message}`, 'error');
        }
    }

    addSyncLog(`üéâ ${successCount} clientes sincronizados com sucesso!`, 'success');
}

async function syncProjectsToSupabase() {
    addSyncLog('üì§ Enviando projetos para o Supabase...', 'info');
    const projects = await getAllRecords(STORES.projects);
    let successCount = 0;

    for (const project of projects) {
        try {
            const { error } = await supabaseClient
                .from(SUPABASE_TABLES.projects)
                .upsert({
                    id: project.id,
                    local_id: project.id,
                    cliente_id: project.cliente_id,
                    cpf: project.cliente_cpf,
                    nome: project.titulo,
                    descricao: project.descricao,
                    status: project.status,
                    progresso: project.progresso || 0,
                    data_inicio: project.created_at
                }, { onConflict: 'id' });

            if (error) throw error;
            successCount++;
            addSyncLog(`‚úÖ Projeto "${project.titulo}" sincronizado`, 'success');
        } catch (error) {
            addSyncLog(`‚ùå Erro ao sincronizar projeto ${project.titulo}: ${error.message}`, 'error');
        }
    }

    addSyncLog(`üéâ ${successCount} projetos sincronizados com sucesso!`, 'success');
}

async function syncDeadlinesToSupabase() {
    addSyncLog('üì§ Enviando prazos para o Supabase...', 'info');
    const deadlines = await getAllRecords(STORES.deadlines);
    let successCount = 0;

    for (const deadline of deadlines) {
        try {
            const { error } = await supabaseClient
                .from(SUPABASE_TABLES.deadlines)
                .upsert({
                    id: deadline.id,
                    local_id: deadline.id,
                    cliente_id: deadline.cliente_id,
                    cpf: deadline.cliente_cpf,
                    titulo: deadline.titulo,
                    descricao: deadline.descricao,
                    data: deadline.data_limite,
                    status: deadline.status || 'pendente'
                }, { onConflict: 'id' });

            if (error) throw error;
            successCount++;
            addSyncLog(`‚úÖ Prazo "${deadline.titulo}" sincronizado`, 'success');
        } catch (error) {
            addSyncLog(`‚ùå Erro ao sincronizar prazo ${deadline.titulo}: ${error.message}`, 'error');
        }
    }

    addSyncLog(`üéâ ${successCount} prazos sincronizados com sucesso!`, 'success');
}

async function syncAlertsToSupabase() {
    addSyncLog('üì§ Enviando alertas para o Supabase...', 'info');
    const alerts = await getAllRecords(STORES.alerts);
    let successCount = 0;

    for (const alert of alerts) {
        try {
            const { error } = await supabaseClient
                .from(SUPABASE_TABLES.alerts)
                .upsert({
                    id: alert.id,
                    local_id: alert.id,
                    cliente_id: alert.cliente_id,
                    cpf: alert.cliente_cpf,
                    titulo: alert.titulo,
                    descricao: alert.mensagem,
                    tipo: alert.tipo || 'info',
                    status: alert.status || 'active',
                    criado_em: alert.created_at
                }, { onConflict: 'id' });

            if (error) throw error;
            successCount++;
            addSyncLog(`‚úÖ Alerta "${alert.titulo}" sincronizado`, 'success');
        } catch (error) {
            addSyncLog(`‚ùå Erro ao sincronizar alerta ${alert.titulo}: ${error.message}`, 'error');
        }
    }

    addSyncLog(`üéâ ${successCount} alertas sincronizados com sucesso!`, 'success');
}

async function syncLinksToSupabase() {
    addSyncLog('üì§ Enviando links para o Supabase...', 'info');
    const links = await getAllRecords(STORES.links);
    let successCount = 0;

    for (const link of links) {
        try {
            const { error } = await supabaseClient
                .from(SUPABASE_TABLES.links)
                .upsert({
                    id: link.id,
                    local_id: link.id,
                    cliente_id: link.cliente_id,
                    cpf: link.cliente_cpf,
                    titulo: link.titulo,
                    url: link.url,
                    descricao: link.descricao,
                    status: link.status || 'active',
                    criado_em: link.created_at
                }, { onConflict: 'id' });

            if (error) throw error;
            successCount++;
            addSyncLog(`‚úÖ Link "${link.titulo}" sincronizado`, 'success');
        } catch (error) {
            addSyncLog(`‚ùå Erro ao sincronizar link ${link.titulo}: ${error.message}`, 'error');
        }
    }

    addSyncLog(`üéâ ${successCount} links sincronizados com sucesso!`, 'success');
}

async function syncAllFromSupabase() {
    if (!supabaseClient) {
        showToast('Conecte-se ao Supabase primeiro!', 'danger');
        return;
    }

    addSyncLog('‚¨áÔ∏è Iniciando PULL de dados do Supabase...', 'info');
    showToast('üì• Baixando dados do Supabase...', 'info');

    try {
        await downloadClientsFromSupabase();
        await downloadProjectsFromSupabase();
        await downloadDeadlinesFromSupabase();
        await downloadAlertsFromSupabase();
        await downloadLinksFromSupabase();

        addSyncLog('‚úÖ PULL completo! Todos os dados foram baixados com sucesso!', 'success');
        showToast('‚úÖ Sincroniza√ß√£o PULL conclu√≠da!', 'success');
        
        loadClients();
        loadProjects();
        loadDeadlines();
        loadAlerts();
        loadLinks();
        updateDashboard();
    } catch (error) {
        console.error('Download error:', error);
        addSyncLog('‚ùå Erro no PULL: ' + error.message, 'error');
        showToast('‚ùå Erro na sincroniza√ß√£o PULL', 'danger');
    }
}

async function downloadClientsFromSupabase() {
    addSyncLog('üì• Baixando clientes do Supabase...', 'info');
    
    const { data, error } = await supabaseClient
        .from(SUPABASE_TABLES.clients)
        .select('*');

    if (error) throw error;

    for (const client of data) {
        try {
            const localClient = {
                id: client.id || client.local_id,
                nome: client.nome,
                cpf: client.cpf,
                email: client.email,
                senha: client.senha,
                status: client.status,
                created_at: client.criado_em
            };
            
            try {
                await updateRecord(STORES.clients, localClient);
            } catch (e) {
                await addRecord(STORES.clients, localClient);
            }
        } catch (error) {
            console.error('Error syncing client:', error);
        }
    }

    addSyncLog(`‚úÖ ${data.length} clientes baixados`, 'success');
}

async function downloadProjectsFromSupabase() {
    addSyncLog('üì• Baixando projetos do Supabase...', 'info');
    
    const { data, error } = await supabaseClient
        .from(SUPABASE_TABLES.projects)
        .select('*');

    if (error) throw error;

    for (const project of data) {
        try {
            const localProject = {
                id: project.id || project.local_id,
                cliente_id: project.cliente_id,
                cliente_cpf: project.cpf,
                titulo: project.nome,
                descricao: project.descricao,
                status: project.status,
                progresso: project.progresso,
                created_at: project.data_inicio
            };
            
            try {
                await updateRecord(STORES.projects, localProject);
            } catch (e) {
                await addRecord(STORES.projects, localProject);
            }
        } catch (error) {
            console.error('Error syncing project:', error);
        }
    }

    addSyncLog(`‚úÖ ${data.length} projetos baixados`, 'success');
}

async function downloadDeadlinesFromSupabase() {
    addSyncLog('üì• Baixando prazos do Supabase...', 'info');
    
    const { data, error } = await supabaseClient
        .from(SUPABASE_TABLES.deadlines)
        .select('*');

    if (error) throw error;

    for (const deadline of data) {
        try {
            const localDeadline = {
                id: deadline.id || deadline.local_id,
                cliente_id: deadline.cliente_id,
                cliente_cpf: deadline.cpf,
                titulo: deadline.titulo,
                descricao: deadline.descricao,
                data_limite: deadline.data,
                status: deadline.status,
                created_at: deadline.data
            };
            
            try {
                await updateRecord(STORES.deadlines, localDeadline);
            } catch (e) {
                await addRecord(STORES.deadlines, localDeadline);
            }
        } catch (error) {
            console.error('Error syncing deadline:', error);
        }
    }

    addSyncLog(`‚úÖ ${data.length} prazos baixados`, 'success');
}

async function downloadAlertsFromSupabase() {
    addSyncLog('üì• Baixando alertas do Supabase...', 'info');
    
    const { data, error } = await supabaseClient
        .from(SUPABASE_TABLES.alerts)
        .select('*');

    if (error) throw error;

    for (const alert of data) {
        try {
            const localAlert = {
                id: alert.id || alert.local_id,
                cliente_id: alert.cliente_id,
                cliente_cpf: alert.cpf,
                titulo: alert.titulo,
                mensagem: alert.descricao,
                tipo: alert.tipo,
                status: alert.status,
                created_at: alert.criado_em
            };
            
            try {
                await updateRecord(STORES.alerts, localAlert);
            } catch (e) {
                await addRecord(STORES.alerts, localAlert);
            }
        } catch (error) {
            console.error('Error syncing alert:', error);
        }
    }

    addSyncLog(`‚úÖ ${data.length} alertas baixados`, 'success');
}

async function downloadLinksFromSupabase() {
    addSyncLog('üì• Baixando links do Supabase...', 'info');
    
    const { data, error } = await supabaseClient
        .from(SUPABASE_TABLES.links)
        .select('*');

    if (error) throw error;

    for (const link of data) {
        try {
            const localLink = {
                id: link.id || link.local_id,
                cliente_id: link.cliente_id,
                cliente_cpf: link.cpf,
                titulo: link.titulo,
                url: link.url,
                descricao: link.descricao,
                status: link.status,
                created_at: link.criado_em
            };
            
            try {
                await updateRecord(STORES.links, localLink);
            } catch (e) {
                await addRecord(STORES.links, localLink);
            }
        } catch (error) {
            console.error('Error syncing link:', error);
        }
    }

    addSyncLog(`‚úÖ ${data.length} links baixados`, 'success');
}

// ==================== INITIALIZATION ====================
document.addEventListener('DOMContentLoaded', async () => {
    try {
        await initDB();
        console.log('‚úÖ IndexedDB iniciado com sucesso');
        
        updateDashboard();
        loadClients();
        
        addSyncLog('‚úÖ Sistema administrativo iniciado com sucesso!', 'success');
    } catch (error) {
        console.error('‚ùå Erro de inicializa√ß√£o:', error);
        showToast('Erro ao inicializar sistema', 'danger');
    }
});
    </script>
</body>
</html>
